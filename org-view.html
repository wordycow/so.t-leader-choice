<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>so.t 조직도 텍스트 트리 뷰어 (v2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: #f3f4f6;
    }
    .wrap {
      max-width: 1200px;
      margin: 24px auto;
      padding: 0 12px 24px;
    }
    h1 {
      font-size: 18px;
      margin: 0 0 6px;
    }
    .subtitle {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      gap: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 12px 14px 14px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.1);
      border: 1px solid #e5e7eb;
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .card-title {
      font-size: 13px;
      font-weight: 600;
    }
    .small-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f3f4f6;
      color: #4b5563;
    }

    textarea#rawInput {
      width: 100%;
      min-height: 260px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      padding: 8px 10px;
      font-size: 11px;
      resize: vertical;
      background: #f9fafb;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      line-height: 1.4;
    }

    button#parseBtn {
      margin-top: 8px;
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg,#2563eb,#1d4ed8);
      color: #fff;
      box-shadow: 0 6px 16px rgba(37,99,235,0.4);
    }
    button#parseBtn:hover {
      background: linear-gradient(135deg,#1d4ed8,#1e40af);
      transform: translateY(-1px);
    }

    .hint {
      font-size: 11px;
      color: #6b7280;
      margin-top: 6px;
      line-height: 1.5;
    }
    .hint code {
      background: #0f172a;
      color: #e5e7eb;
      padding: 2px 4px;
      border-radius: 4px;
    }

    /* 텍스트 트리 출력 */
    .tree-box {
      max-height: 360px;
      overflow: auto;
      background: #f9fafb;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 11px;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .tree-line {
      margin: 1px 0;
    }

    .tree-line.leg-1 { color: #1d4ed8; } /* 왼쪽 다리 */
    .tree-line.leg-2 { color: #b91c1c; } /* 오른쪽 다리 */

    /* 바이너리 레이아웃 */
    .binary-wrap {
      margin-top: 10px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 8px 10px 10px;
      font-size: 11px;
    }
    .binary-title {
      font-size: 11px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }
    .binary-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .binary-col-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 11px;
    }

    .node-card {
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      margin-bottom: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .node-card .id {
      font-size: 10px;
      color: #6b7280;
    }
    .node-card .name {
      font-size: 11px;
      font-weight: 600;
      color: #111827;
    }
    .node-card.small { font-size: 10px; }

    .node-card.leg-1 {
      border-color: #bfdbfe;
      background: #eff6ff;
    }
    .node-card.leg-2 {
      border-color: #fecaca;
      background: #fef2f2;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>so.t 조직도 텍스트 트리 뷰어 · v2</h1>
  <p class="subtitle">
    1) ssoti 조직도 페이지에서 텍스트 트리를 전체 복사(Ctrl+A → Ctrl+C)한 뒤<br/>
    2) 아래 입력칸에 붙여넣고 [트리 생성]을 누르면, 오른쪽에 트리 + 아래에 좌/우 레그별 카드가 표시됩니다.<br/>
    (※ 로그인된 ssoti 페이지에서 직접 데이터를 가져올 수는 없기 때문에, 복붙 방식으로 동기화합니다.)
  </p>

  <div class="grid">
    <!-- 왼쪽: 텍스트 붙여넣기 -->
    <div class="card">
      <div class="card-title-row">
        <div class="card-title">A. 조직도 텍스트 붙여넣기</div>
        <span class="small-badge">입력</span>
      </div>
      <textarea id="rawInput" placeholder="[1]KR-15323995 / 이유송
 ├─ [1]KR-17655693 / 임정애
 │   ├─ [1]KR-15556549 / 이동진
 │   └─ [2]KR-18594222 / 윤기남
..."></textarea>
      <button id="parseBtn">트리 생성</button>
      <div class="hint">
        ▷ 들여쓰기/선이 포함된 트리 텍스트를 그대로 붙여넣어도 됩니다.<br/>
        ▷ 각 줄은 보통 <code>[1]KR-12345678 / 이름</code> 형태입니다. <code>[1]</code>은 왼쪽 다리, <code>[2]</code>는 오른쪽 다리로 구분합니다.<br/>
      </div>
    </div>

    <!-- 오른쪽: 트리 + 바이너리 레이아웃 -->
    <div class="card">
      <div class="card-title-row">
        <div class="card-title">B. 트리 & 간단 바이너리 레이아웃</div>
        <span class="small-badge">결과</span>
      </div>

      <div id="treeBox" class="tree-box">
        붙여넣고 [트리 생성] 버튼을 누르면, 여기에서 트리가 표시됩니다.
      </div>

      <div id="binaryLayout" class="binary-wrap">
        <div class="binary-title">좌/우 레그별 단순 리스트</div>
        <div class="binary-grid">
          <div>
            <div class="binary-col-title">LEFT ( [1] )</div>
            <div id="leftCol"></div>
          </div>
          <div>
            <div class="binary-col-title">RIGHT ( [2] )</div>
            <div id="rightCol"></div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  const rawInput   = document.getElementById("rawInput");
  const parseBtn   = document.getElementById("parseBtn");
  const treeBox    = document.getElementById("treeBox");
  const leftCol    = document.getElementById("leftCol");
  const rightCol   = document.getElementById("rightCol");

  parseBtn.addEventListener("click", () => {
    const text = rawInput.value;
    if (!text.trim()) {
      alert("ssoti 조직도 페이지에서 텍스트를 복사해 붙여넣은 뒤 다시 눌러주세요.");
      return;
    }

    const lines = text.split(/\r?\n/);

    // depth별 마지막 노드(stack)
    const stack = [];
    const leftNodes = [];
    const rightNodes = [];

    treeBox.innerHTML = "";
    leftCol.innerHTML = "";
    rightCol.innerHTML = "";

    lines.forEach((lineRaw) => {
      // 탭 → 공백, 오른쪽 공백 제거
      const lineWithSpaces = lineRaw.replace(/\t/g, "    ");
      const line = lineWithSpaces.replace(/\s+$/, "");
      if (!line.trim()) return;

      // 앞쪽 트리선(│, ├, └, ─, 공백) 부분
      const leadingMatch = line.match(/^[\s│├└─]*/);
      const leading = leadingMatch ? leadingMatch[0] : "";
      const depth = Math.floor(leading.replace(/[│├└─]/g, " ").length / 2);

      // 내용 부분만 (선 제거)
      let content = line.replace(/^[\s│├└─]+/, "").trim();
      if (!content) return;

      // [1]/[2], ID, 이름 파싱
      // 예: [1]KR-15323995 / 이유송
      let leg = null;
      let id = "";
      let name = "";
      const m = content.match(/^\[(\d)\]\s*([^/]+)\/\s*(.+)$/);
      if (m) {
        leg = m[1];         // "1" or "2"
        id  = m[2].trim();  // "KR-15323995"
        name= m[3].trim();  // "이유송"
      }

      // 트리 텍스트 출력 (side 기준 색칠)
      const lineEl = document.createElement("div");
      lineEl.className = "tree-line";
      lineEl.style.marginLeft = (depth * 16) + "px";
      lineEl.textContent = content;
      treeBox.appendChild(lineEl);

      // 노드 객체 만들기
      const node = {
        depth,
        leg,
        id,
        name,
        side: null  // 최상단에서 처음 만난 1/2 (루트 아래 첫 갈래)
      };

      if (depth === 0) {
        // 루트 노드
        node.side = null;
      } else {
        const parent = stack[depth - 1];
        if (parent) {
          if (parent.side === null) {
            // 루트 바로 아래 자식이라면, 이 노드의 leg가 side가 됨
            if (leg === "1") node.side = 1;
            else if (leg === "2") node.side = 2;
          } else {
            // 이미 위에서 어느 쪽으로 내려가고 있는지 정해져 있으면 그대로 상속
            node.side = parent.side;
          }
        }
      }

      // depth 위치에 현재 노드 저장
      stack[depth] = node;

      // side에 따라 LEFT/RIGHT 리스트에 추가
      if (node.side === 1) {
        const card = document.createElement("div");
        card.className = "node-card leg-1";
        card.innerHTML = `
          <div class="name">${node.name || ""}</div>
          <div class="id">${node.id || ""}</div>
        `;
        leftCol.appendChild(card);

        // 텍스트 트리 색도 side 기준으로
        lineEl.classList.add("leg-1");
      } else if (node.side === 2) {
        const card = document.createElement("div");
        card.className = "node-card leg-2";
        card.innerHTML = `
          <div class="name">${node.name || ""}</div>
          <div class="id">${node.id || ""}</div>
        `;
        rightCol.appendChild(card);

        lineEl.classList.add("leg-2");
      }
    });
  });
</script>
</body>
</html>
