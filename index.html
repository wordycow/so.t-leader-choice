<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>함께 떠날 여행 리더를 선택하세요</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --page-max-width: 1200px;
      --card-bg: #24527a;
      --accent-gold-soft: #fde68a;
      --text-main: #111827;
      --text-sub: #4b5563;
      --btn-primary-bg: #f59e0b;
      --btn-primary-bg-hover: #d97706;
      --btn-primary-text: #1f2933;
      --tag-bg: rgba(255, 255, 255, 0.15);
      --tag-border: rgba(250, 250, 250, 0.4);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      color: var(--text-main);
      background-image: url("bg_wallpaper.jpg");
      background-size: cover;
      background-position: center top;
      background-attachment: fixed;
    }

    .page {
      max-width: var(--page-max-width);
      margin: 0 auto;
      padding: 24px 12px 40px;
    }

    header.hero {
      text-align: center;
      padding: 24px 12px 12px;
      color: #f9fafb;
      text-shadow: 0 2px 8px rgba(0,0,0,0.35);
    }

    .hero-title {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 0.04em;
      margin: 0 0 8px;
    }

    .hero-subtitle {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
    }

    .hero-note {
      margin-top: 6px;
      font-size: 11px;
      opacity: 0.8;
    }

    main { margin-top: 10px; }

    .leaders-section {
      background: rgba(180, 206, 238, 0.9);
      border-radius: 26px;
      padding: 18px 10px 24px;
      box-shadow: 0 18px 45px rgba(15,23,42,0.55);
      backdrop-filter: blur(12px);
    }

    .leaders-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px;
    }

    .leader-card {
      background: var(--card-bg);
      border-radius: 26px;
      padding: 7px;
      box-shadow: 0 16px 30px rgba(15,23,42,0.45);
      position: relative;
    }

    .leader-card-inner {
      border-radius: 22px;
      background: radial-gradient(circle at top, #ffffff 0%, #f3f4f6 40%, #e5e7eb 100%);
      padding: 12px;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .leader-image-wrap {
      border-radius: 18px;
      overflow: hidden;
      border: 3px solid var(--accent-gold-soft);
      margin-bottom: 10px;
      background: #e5e7eb;
    }

    .leader-image {
      width: 100%;
      height: 170px;
      object-fit: cover;
      display: block;
    }

    .leader-role {
      font-size: 11px;
      font-weight: 600;
      color: #6b21a8;
      margin-bottom: 3px;
    }

    .leader-name {
      margin: 0 0 6px;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.03em;
      color: #111827;
    }

    .leader-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 8px;
    }

    .tag {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid var(--tag-border);
      background: var(--tag-bg);
      color: #111827;
      backdrop-filter: blur(4px);
    }

    .leader-headline {
      font-size: 12px;
      color: var(--text-sub);
      margin: 0 0 4px;
      line-height: 1.5;
    }

    .leader-intro {
      font-size: 11px;
      color: #6b7280;
      margin: 0 0 10px;
      line-height: 1.5;
    }

    .leader-sns {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 8px;
    }

    .btn-sns {
      font-size: 10px;
      border-radius: 999px;
      padding: 2px 8px;
      border: none;
      cursor: pointer;
      text-decoration: none;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-sns.youtube  { background: #ff0000; }
    .btn-sns.instagram{ background: #c13584; }
    .btn-sns.blog     { background: #16a34a; }
    .btn-sns.tiktok   { background: #111827; }
    .btn-sns.facebook { background: #1d4ed8; }
    .btn-sns.carrot   { background: #ff7e3f; }
    .btn-sns.discord  { background: #5865f2; }

    .card-footer {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(209, 213, 219, 0.8);
    }

    .visible-pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #15803d;
      border: 1px solid #bbf7d0;
    }

    .btn-primary {
      font-size: 11px;
      font-weight: 600;
      border-radius: 999px;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      text-decoration: none;
      background: linear-gradient(135deg, var(--btn-primary-bg), #facc15);
      color: var(--btn-primary-text);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 5px 14px rgba(180, 83, 9, 0.45);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--btn-primary-bg-hover), #f59e0b);
      transform: translateY(-1px);
    }

    .btn-primary span.icon { font-size: 13px; }

    /* 광고 배너 (공통) */
    .ads-section {
      margin-top: 26px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(15,23,42,0.65);
      background: #0f172a;
    }

    .ads-section.hidden { display: none; }

    .ad-card {
      position: relative;
      height: 280px;  /* 상단 배너 더 크게 */
      overflow: hidden;
    }

    .ad-bg {
      position: absolute;
      inset: 0;
      background-position: center;
      background-size: cover;
      transform: scale(1.03);
      filter: saturate(1.15);
    }

    .ad-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(15,23,42,0.7) 0%, rgba(15,23,42,0.1) 50%, rgba(15,23,42,0.8) 100%);
    }

    .ad-content {
      position: relative;
      z-index: 1;
      height: 100%;
      padding: 18px 20px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      color: #f9fafb;
    }

    .ad-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 6px;
    }

    .ad-marquee {
      position: absolute;
      left: 20px;
      right: 20px;
      bottom: 10px;
      overflow: hidden;
      white-space: nowrap;
      font-size: 13px;
      color: #fefce8;
    }

    .ad-marquee span {
      display: inline-block;
      padding-right: 100%;
      animation: marquee 14s linear infinite;
    }

    @keyframes marquee {
      from { transform: translateX(0%); }
      to   { transform: translateX(-100%); }
    }

    /* 하단 광고 카드 */
    .ads-bottom-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .ad-bottom-card {
      position: relative;
      height: 180px;
      border-radius: 20px;
      overflow: hidden;
      background: #0f172a;
      box-shadow: 0 10px 24px rgba(15,23,42,0.6);
    }

    .ad-bottom-bg {
      position: absolute;
      inset: 0;
      background-position: center;
      background-size: cover;
      transform: scale(1.03);
      filter: saturate(1.1);
    }

    .ad-bottom-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(0deg, rgba(15,23,42,0.8) 0%, rgba(15,23,42,0.1) 70%);
    }

    .ad-bottom-text {
      position: relative;
      z-index: 1;
      padding: 12px 18px;
      color: #f9fafb;
      font-size: 12px;
    }

    .ad-bottom-title {
      font-weight: 700;
      margin-bottom: 4px;
    }

    .status-bar {
      margin-top: 10px;
      font-size: 11px;
      color: #e5e7eb;
      text-align: center;
      text-shadow: 0 1px 4px rgba(15,23,42,0.7);
    }

    .message {
      text-align: center;
      font-size: 13px;
      color: #f9fafb;
      text-shadow: 0 1px 4px rgba(15,23,42,0.7);
      margin-bottom: 12px;
    }
    .message.error { color: #fee2e2; }

    footer {
      margin-top: 16px;
      text-align: center;
      font-size: 11px;
      color: #e5e7eb;
      text-shadow: 0 1px 4px rgba(15,23,42,0.7);
    }

    @media (max-width: 768px) {
      .hero-title { font-size: 22px; }
      .leaders-section { padding: 14px 8px 18px; }
      .ad-card { height: 220px; }
      .ad-bottom-card { height: 160px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <h1 class="hero-title" id="hero-title">함께 떠날 여행 리더를 선택하세요</h1>
      <p class="hero-subtitle" id="hero-subtitle">
        리더의 여행 스타일과 컨셉을 가볍게 읽어본 뒤, 마음에 드는 리더 카드를 눌러 상담·신청(구글폼)으로 이동해 보세요.
      </p>
      <p class="hero-note">
        이 페이지는 <code>leaders.json</code> 파일 내용을 기반으로 자동으로 구성됩니다.
      </p>
    </header>

    <main>
      <div id="message" class="message">리더 정보를 불러오는 중입니다...</div>

      <!-- 상단 여행 일정 배너 -->
      <section id="ads-top" class="ads-section hidden"></section>

      <section class="leaders-section">
        <div id="leaders-grid" class="leaders-grid"></div>
      </section>

      <!-- 리더보드 아래 하단 광고들 -->
      <section id="ads-bottom" class="ads-section hidden"></section>

      <div class="status-bar">
        데이터 소스: <a href="https://github.com/wordycow/so.t-leader-choice/blob/main/leaders.json" target="_blank" style="color:#facc15;">leaders.json (GitHub)</a>
      </div>
    </main>

    <footer>
      so.t leader choice
    </footer>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      loadData();
    });

    async function loadData() {
      const messageEl   = document.getElementById("message");
      const leadersGrid = document.getElementById("leaders-grid");
      const adsTop      = document.getElementById("ads-top");
      const adsBottom   = document.getElementById("ads-bottom");

      try {
        const res = await fetch("leaders.json?_=" + Date.now());
        if (!res.ok) throw new Error("HTTP " + res.status);
        const json = await res.json();

        const root    = json.data ? json.data : json;
        const leaders = Array.isArray(root.leaders) ? root.leaders : [];
        const ads     = Array.isArray(root.ads) ? root.ads : [];
        const bannerPosition = root.bannerPosition || "bottom";

        renderLeaders(leadersGrid, leaders);
        renderAdsTopBottom(adsTop, adsBottom, ads, bannerPosition);

        if (leaders.length === 0) {
          messageEl.textContent = "leaders.json 안에 leaders 데이터가 없습니다. 관리자 페이지에서 리더 정보를 추가해 주세요.";
        } else {
          messageEl.textContent = "";
        }

        if (root.meta && root.meta.title) {
          document.getElementById("hero-title").textContent = root.meta.title;
        }
        if (root.meta && root.meta.subtitle) {
          document.getElementById("hero-subtitle").textContent = root.meta.subtitle;
        }
      } catch (error) {
        console.error(error);
        messageEl.classList.add("error");
        messageEl.textContent = "leaders.json을 불러오는 중 오류가 발생했습니다: " + error.message;
        leadersGrid.innerHTML = "";
        adsTop.classList.add("hidden");
        adsBottom.classList.add("hidden");
      }
    }

    /* 리더 카드 렌더링 */
    function renderLeaders(container, leadersRaw) {
      container.innerHTML = "";
      const visibleLeaders = (leadersRaw || []).filter(l => l && l.enabled !== false && l.visible !== false);

      visibleLeaders.sort((a, b) => {
        const ao = (typeof a.order === "number") ? a.order : 9999;
        const bo = (typeof b.order === "number") ? b.order : 9999;
        if (ao === bo) return (a.name || "").localeCompare(b.name || "", "ko");
        return ao - bo;
      });

      if (!visibleLeaders.length) {
        const empty = document.createElement("div");
        empty.className = "message";
        empty.textContent = "현재 노출 설정된 리더가 없습니다. 관리자 페이지에서 리더의 노출을 켜 주세요.";
        container.appendChild(empty);
        return;
      }

      visibleLeaders.forEach(leader => {
        const card = document.createElement("article");
        card.className = "leader-card";

        const inner = document.createElement("div");
        inner.className = "leader-card-inner";

        const imgWrap = document.createElement("div");
        imgWrap.className = "leader-image-wrap";
        const img = document.createElement("img");
        img.className = "leader-image";
        img.alt = leader.name || "리더 이미지";
        if (leader.imageUrl || leader.mediaUrl) {
          img.src = leader.imageUrl || leader.mediaUrl;
        } else {
          img.src = "data:image/gif;base64,R0lGODlhAQABAAAAACw=";
        }
        imgWrap.appendChild(img);

        const roleEl = document.createElement("div");
        roleEl.className = "leader-role";
        roleEl.textContent = leader.role || "";

        const nameEl = document.createElement("h2");
        nameEl.className = "leader-name";
        nameEl.textContent = leader.name || "(이름 없음)";

        const tagsEl = document.createElement("div");
        tagsEl.className = "leader-tags";
        const tags = Array.isArray(leader.tags) ? leader.tags : [];
        tags.forEach(tag => {
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = tag;
          tagsEl.appendChild(span);
        });

        const headlineEl = document.createElement("p");
        headlineEl.className = "leader-headline";
        headlineEl.textContent = leader.headline || leader.introShort || "";

        const introEl = document.createElement("p");
        introEl.className = "leader-intro";
        introEl.textContent = leader.intro || "";

        const snsWrap = document.createElement("div");
        snsWrap.className = "leader-sns";
        const sns = leader.sns || {};

        if (sns.youtube)   snsWrap.appendChild(createSnsButton("YouTube", sns.youtube, "youtube"));
        if (sns.instagram) snsWrap.appendChild(createSnsButton("Instagram", sns.instagram, "instagram"));
        if (sns.blog)      snsWrap.appendChild(createSnsButton("Blog", sns.blog, "blog"));
        if (sns.tiktok)    snsWrap.appendChild(createSnsButton("TikTok", sns.tiktok, "tiktok"));
        if (sns.facebook)  snsWrap.appendChild(createSnsButton("Facebook", sns.facebook, "facebook"));
        if (sns.carrot)    snsWrap.appendChild(createSnsButton("당근", sns.carrot, "carrot"));
        if (sns.discord)   snsWrap.appendChild(createSnsButton("Discord", sns.discord, "discord"));

        const footer = document.createElement("div");
        footer.className = "card-footer";

        const pill = document.createElement("span");
        pill.className = "visible-pill";
        pill.textContent = "노출 중";
        footer.appendChild(pill);

        if (leader.formUrl || leader.link) {
          const btn = document.createElement("a");
          btn.href = leader.formUrl || leader.link;
          btn.target = "_blank";
          btn.rel = "noopener noreferrer";
          btn.className = "btn-primary";
          btn.innerHTML = '<span class="icon">✈️</span><span>상담 / 신청하기</span>';
          footer.appendChild(btn);
        }

        inner.appendChild(imgWrap);
        inner.appendChild(roleEl);
        inner.appendChild(nameEl);
        if (tags.length) inner.appendChild(tagsEl);
        if (leader.headline || leader.introShort) inner.appendChild(headlineEl);
        if (leader.intro) inner.appendChild(introEl);
        if (snsWrap.children.length) inner.appendChild(snsWrap);
        inner.appendChild(footer);

        card.appendChild(inner);
        container.appendChild(card);
      });
    }

    function createSnsButton(label, url, type) {
      const a = document.createElement("a");
      a.href = url;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.className = "btn-sns " + type;
      a.textContent = label;
      return a;
    }

    /* 광고: 상단 + 하단 분리 렌더링 */
    function renderAdsTopBottom(topSection, bottomSection, adsRaw, bannerPosition) {
      const visibleAds = (adsRaw || []).filter(a => a && a.enabled !== false);

      // 초기화
      topSection.classList.add("hidden");
      topSection.innerHTML = "";
      bottomSection.classList.add("hidden");
      bottomSection.innerHTML = "";

      if (!visibleAds.length) return;

      // bannerPosition: top → 첫 번째는 상단, 나머지는 하단
      // bannerPosition: bottom → 상단은 숨기고, 전부 하단에만 표시
      let topAd  = null;
      let restAd = [];

      if (bannerPosition === "top") {
        topAd  = visibleAds[0];
        restAd = visibleAds.slice(1);
      } else {
        restAd = visibleAds;
      }

      // 상단 여행 일정 배너
      if (topAd) {
        topSection.classList.remove("hidden");

        const link = topAd.linkUrl || "#";
        const a = document.createElement("a");
        a.href = link;
        if (topAd.linkUrl) {
          a.target = "_blank";
          a.rel = "noopener noreferrer";
        }
        a.style.display = "block";
        a.style.textDecoration = "none";

        const card = document.createElement("div");
        card.className = "ad-card";

        const bg = document.createElement("div");
        bg.className = "ad-bg";
        if (topAd.imageUrl) {
          bg.style.backgroundImage = "url('" + topAd.imageUrl + "')";
        }

        const overlay = document.createElement("div");
        overlay.className = "ad-overlay";

        const content = document.createElement("div");
        content.className = "ad-content";

        const titleEl = document.createElement("h2");
        titleEl.className = "ad-title";
        titleEl.textContent = topAd.text || "여행 일정 안내";

        content.appendChild(titleEl);

        const marquee = document.createElement("div");
        marquee.className = "ad-marquee";
        const span = document.createElement("span");
        span.textContent = topAd.desc || topAd.text || "";
        marquee.appendChild(span);

        card.appendChild(bg);
        card.appendChild(overlay);
        card.appendChild(content);
        card.appendChild(marquee);

        a.appendChild(card);
        topSection.appendChild(a);
      }

      // 하단 광고들
      if (restAd.length) {
        bottomSection.classList.remove("hidden");
        const list = document.createElement("div");
        list.className = "ads-bottom-list";

        restAd.forEach(ad => {
          const link = ad.linkUrl || "#";
          const a = document.createElement("a");
          a.href = link;
          if (ad.linkUrl) {
            a.target = "_blank";
            a.rel = "noopener noreferrer";
          }
          a.style.display = "block";
          a.style.textDecoration = "none";

          const card = document.createElement("div");
          card.className = "ad-bottom-card";

          const bg = document.createElement("div");
          bg.className = "ad-bottom-bg";
          if (ad.imageUrl) {
            bg.style.backgroundImage = "url('" + ad.imageUrl + "')";
          }

          const overlay = document.createElement("div");
          overlay.className = "ad-bottom-overlay";

          const textBox = document.createElement("div");
          textBox.className = "ad-bottom-text";
          const titleEl = document.createElement("div");
          titleEl.className = "ad-bottom-title";
          titleEl.textContent = ad.text || "여행 안내";

          const descEl = document.createElement("div");
          descEl.textContent = ad.desc || "";

          textBox.appendChild(titleEl);
          textBox.appendChild(descEl);

          card.appendChild(bg);
          card.appendChild(overlay);
          card.appendChild(textBox);

          a.appendChild(card);
          list.appendChild(a);
        });

        bottomSection.appendChild(list);
      }
    }
  </script>
</body>
</html>
