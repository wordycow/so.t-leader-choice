<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì—¬í–‰ ë¦¬ë” ê´€ë¦¬ì í˜ì´ì§€ (ì—¬í–‰ ìŠ¤ì¼€ì¤„ + ê´‘ê³  + JSON ìƒì„±ê¸°)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      color: #111827;
      background-image: url("bg_wallpaper.jpg");
      background-size: cover;
      background-position: center top;
      background-attachment: fixed;
    }

    .page-wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 12px 32px;
    }

    .glass-panel {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      border: 1px solid rgba(209,213,219,1);
      box-shadow: 0 20px 40px rgba(0,0,0,0.35);
      padding: 20px 18px 22px;
    }

    .page-header {
      text-align: center;
      margin-bottom: 16px;
    }
    .page-title {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    .page-subtitle {
      font-size: 12px;
      color: #4b5563;
      line-height: 1.6;
    }

    .admin-layout {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      gap: 18px;
      margin-top: 8px;
    }

    .admin-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
      font-size: 13px;
      border: 1px solid #e5e7eb;
    }

    .admin-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .admin-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .section-label {
      font-size: 12px;
      font-weight: 600;
      margin: 4px 0 6px;
    }

    .form-group { margin-bottom: 8px; }
    label {
      display: block;
      font-size: 12px;
      margin-bottom: 3px;
      color: #374151;
    }
    input[type="text"],
    textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 12px;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    input[type="file"] { font-size: 11px; }
    small { font-size: 11px; color: #6b7280; }

    .inline {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      cursor: pointer;
    }
    .btn-primary {
      background-color: #2563eb;
      color: #fff;
      margin-right: 4px;
    }
    .btn-secondary {
      background-color: #6b7280;
      color: #fff;
      margin-right: 4px;
    }
    .btn-danger {
      background-color: #ef4444;
      color: #fff;
    }
    .btn-outline {
      background-color: #ffffff;
      color: #4b5563;
      border: 1px solid #d1d5db;
    }
    .btn-xs {
      padding: 4px 8px;
      font-size: 11px;
    }

    .btn-new-leader {
      background-color: #2563eb;
      color: #ffffff;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      border: none;
      box-shadow: 0 4px 10px rgba(37,99,235,0.35);
      cursor: pointer;
    }
    .btn-new-leader:hover { background-color: #1d4ed8; }

    .trip-list, .ad-list, .leader-list {
      max-height: none;
      overflow-y: visible;
    }
    .trip-item, .ad-item, .leader-item {
      border-bottom: 1px solid #e5e7eb;
      padding: 7px 0;
      font-size: 12px;
    }
    .trip-item:last-child,
    .ad-item:last-child,
    .leader-item:last-child { border-bottom: none; }

    .trip-item-header,
    .ad-item-header,
    .leader-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
    }

    .trip-thumb,
    .ad-thumb,
    .thumb {
      width: 48px;
      height: 32px;
      object-fit: cover;
      border-radius: 4px;
      margin-right: 6px;
      border: 1px solid #e5e7eb;
    }
    .thumb {
      width: 32px;
      height: 40px;
      border-radius: 5px;
    }

    .leader-thumb-slot {
      width: 32px;
      height: 40px;
      border-radius: 5px;
      border: 1px dashed #d1d5db;
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #9ca3af;
      margin-right: 6px;
    }

    .leader-item-name { font-weight: 600; }
    .trip-item-title,
    .ad-item-title { font-weight: 600; font-size: 12px; }

    .link-small {
      font-size: 10px;
      color: #2563eb;
      text-decoration: underline;
      display: inline-block;
      max-width: 260px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .enable-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      margin-left: 6px;
      color: #fff;
    }
    .enable-yes { background: #16a34a; }
    .enable-no  { background: #9ca3af; }

    .drop-zone {
      margin-top: 6px;
      padding: 10px;
      border-radius: 10px;
      border: 2px dashed #cbd5f5;
      background: #f9fafb;
      font-size: 11px;
      color: #4b5563;
      text-align: center;
    }
    .drop-zone.dragover {
      border-color: #2563eb;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .preview-wrap {
      margin-top: 8px;
      display: none;
    }
    .preview-wrap img {
      width: 120px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .json-area {
      width: 100%;
      min-height: 180px;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 11px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background-color: #f9fafb;
      resize: vertical;
      white-space: pre;
    }

    .help-box {
      margin-top: 8px;
      padding: 8px;
      border-radius: 8px;
      background-color: #fefce8;
      border: 1px solid #facc15;
      font-size: 11px;
      color: #4b5563;
      line-height: 1.5;
    }

    @media (max-width: 900px) {
      .admin-layout { grid-template-columns: 1fr; }
      .admin-title-row { flex-direction: column; align-items: flex-start; gap: 8px; }
      .btn-new-leader { width: 100%; text-align: center; }
    }
  </style>
</head>
<body>

<div class="page-wrap">
  <div class="glass-panel">
    <header class="page-header">
      <div class="page-title">ì—¬í–‰ ë¦¬ë” ê´€ë¦¬ì í˜ì´ì§€ (ì—¬í–‰ ìŠ¤ì¼€ì¤„ + ê´‘ê³  + JSON ìƒì„±ê¸°)</div>
      <p class="page-subtitle">
        ì´ í˜ì´ì§€ì—ì„œ <b>ì—¬í–‰ ìŠ¤ì¼€ì¤„(ìƒë‹¨ ë°°ë„ˆ)</b>ì™€ <b>ê´‘ê³  ë°°ë„ˆ(í•˜ë‹¨ ë°°ë„ˆ)</b> ê·¸ë¦¬ê³  <b>ë¦¬ë” ì •ë³´ë¥¼ ëª¨ë‘ ê´€ë¦¬</b>í•˜ê³ ,<br>
        ì•„ë˜ JSONì„ ë³µì‚¬í•˜ì—¬ <b>so.t-leader-choice</b> ë ˆí¬ì˜ <code>leaders.json</code>ì— ë¶™ì—¬ ë„£ìœ¼ë©´<br>
        PC / ëª¨ë°”ì¼ / ëª¨ë“  ì‚¬ìš©ìì˜ ê³µê°œ í˜ì´ì§€ê°€ ë™ì¼í•˜ê²Œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
      </p>
    </header>

    <div class="admin-layout">
      <!-- ì¢Œì¸¡: ì—¬í–‰ ìŠ¤ì¼€ì¤„ + ê´‘ê³  + ë¦¬ë” ì…ë ¥ -->
      <div class="admin-card">
        <!-- ì—¬í–‰ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ -->
        <div class="admin-title">ì—¬í–‰ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ (ë¦¬ë”ë³´ë“œ ìœ„ ìƒë‹¨ ë°°ë„ˆ)</div>

        <input type="hidden" id="editingTripIndex" value="-1" />

        <div class="form-group">
          <label for="tripLinkUrl">ì—¬í–‰ ìŠ¤ì¼€ì¤„ ë§í¬ URL</label>
          <input type="text" id="tripLinkUrl" placeholder="ì˜ˆ) https://youtube.com/@yourchannel ë˜ëŠ” ì—¬í–‰ ìƒì„¸ í˜ì´ì§€" />
        </div>

        <div class="form-group">
          <label for="tripText">ì—¬í–‰ ì¼ì • ë¬¸êµ¬ (ë°°ë„ˆì—ì„œ í˜ëŸ¬ê°ˆ í…ìŠ¤íŠ¸)</label>
          <input type="text" id="tripText" placeholder="ì˜ˆ) 2026ë…„ 3ì›” 12ì¼ ì¶œë°œ í¬ë£¨ì¦ˆ ì—¬í–‰ ëª¨ì§‘" />
        </div>

        <div class="form-group inline">
          <label>
            <input type="checkbox" id="tripEnabled" checked /> ì´ ì—¬í–‰ ìŠ¤ì¼€ì¤„ ë…¸ì¶œ
          </label>
        </div>

        <div class="form-group">
          <label>ì—¬í–‰ ìŠ¤ì¼€ì¤„ ì´ë¯¸ì§€ (ê°€ë¡œí˜• ì´ë¯¸ì§€)</label>
          <input type="file" id="tripImageFile" accept="image/*" />
          <small>íŒŒì¼ ì„ íƒ ë˜ëŠ” ì•„ë˜ ì˜ì—­ì— ë“œë˜ê·¸ ì•¤ ë“œë¡­. (ì´ë¯¸ì§€ ì „ìš©)</small>
          <div id="tripDropZone" class="drop-zone">
            ì—¬ê¸°ë¡œ ì—¬í–‰ ìŠ¤ì¼€ì¤„ ì´ë¯¸ì§€ë¥¼ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”.
          </div>
          <div id="tripPreviewWrap" class="preview-wrap">
            <img id="tripPreviewImage" src="" alt="ì—¬í–‰ ìŠ¤ì¼€ì¤„ ë¯¸ë¦¬ë³´ê¸°" />
          </div>
        </div>

        <div class="form-group inline" style="margin-top:4px;">
          <button class="btn btn-primary" id="saveTripBtn">ì—¬í–‰ ìŠ¤ì¼€ì¤„ ì €ì¥</button>
          <button class="btn btn-secondary" id="clearTripFormBtn">ì—¬í–‰ ìŠ¤ì¼€ì¤„ í¼ ì´ˆê¸°í™”</button>
          <button class="btn btn-outline btn-xs" id="newTripBtn">+ ìƒˆ ìŠ¤ì¼€ì¤„ ì¶”ê°€</button>
        </div>

        <hr style="margin:14px 0;" />

        <div class="section-label">ì—¬í–‰ ìŠ¤ì¼€ì¤„ ë¦¬ìŠ¤íŠ¸ (ìƒë‹¨ ë°°ë„ˆ ìˆœì„œ)</div>
        <div class="trip-list" id="tripList"></div>

        <hr style="margin:18px 0;" />

        <!-- ê´‘ê³  ë°°ë„ˆ ì„¤ì • -->
        <div class="admin-title">ê´‘ê³  ë°°ë„ˆ ê´€ë¦¬ (ë¦¬ë”ë³´ë“œ ì•„ë˜ ë°°ë„ˆ)</div>

        <input type="hidden" id="editingAdIndex" value="-1" />

        <div class="form-group">
          <label for="adLinkUrl">ê´‘ê³  ë§í¬ URL</label>
          <input type="text" id="adLinkUrl" placeholder="ì˜ˆ) https://youtube.com/@yourchannel ë˜ëŠ” ê´‘ê³ ì£¼ ì‚¬ì´íŠ¸" />
        </div>

        <div class="form-group">
          <label for="adText">ê´‘ê³  ë¬¸êµ¬ (ë°°ë„ˆì—ì„œ í˜ëŸ¬ê°ˆ í…ìŠ¤íŠ¸)</label>
          <input type="text" id="adText" placeholder="ì˜ˆ) ai ì´ë¯¸ì§€ë¡œ ë§Œë“  ìŠ¤í† ë¦¬ ë§ˆì„ ì“°í‹°" />
        </div>

        <div class="form-group inline">
          <label>
            <input type="checkbox" id="adEnabled" checked /> ì´ ê´‘ê³  ë…¸ì¶œ
          </label>
        </div>

        <div class="form-group">
          <label>ê´‘ê³  ë°°ë„ˆ ì´ë¯¸ì§€ (ê°€ë¡œí˜• ì´ë¯¸ì§€)</label>
          <input type="file" id="adImageFile" accept="image/*" />
          <small>íŒŒì¼ ì„ íƒ ë˜ëŠ” ì•„ë˜ ì˜ì—­ì— ë“œë˜ê·¸ ì•¤ ë“œë¡­. (ì´ë¯¸ì§€ ì „ìš©)</small>
          <div id="adDropZone" class="drop-zone">
            ì—¬ê¸°ë¡œ ê´‘ê³  ì´ë¯¸ì§€ë¥¼ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”.
          </div>
          <div id="adPreviewWrap" class="preview-wrap">
            <img id="adPreviewImage" src="" alt="ê´‘ê³  ë¯¸ë¦¬ë³´ê¸°" />
          </div>
        </div>

        <div class="form-group inline" style="margin-top:4px;">
          <button class="btn btn-primary" id="saveAdBtn">ê´‘ê³  ì €ì¥</button>
          <button class="btn btn-secondary" id="clearAdFormBtn">ê´‘ê³  í¼ ì´ˆê¸°í™”</button>
          <button class="btn btn-outline btn-xs" id="newAdBtn">+ ìƒˆ ê´‘ê³  ì¶”ê°€</button>
        </div>

        <hr style="margin:14px 0;" />

        <div class="section-label">ê´‘ê³  ë¦¬ìŠ¤íŠ¸ (ë¦¬ë”ë³´ë“œ ì•„ë˜ ë°°ë„ˆ ìˆœì„œ)</div>
        <div class="ad-list" id="adList"></div>

        <hr style="margin:18px 0;" />

        <!-- ë¦¬ë” ì…ë ¥ -->
        <div class="section-label" style="margin-top:2px;">ë¦¬ë” ì •ë³´ ì…ë ¥ / ìˆ˜ì •</div>

        <input type="hidden" id="editingLeaderIndex" value="-1" />

        <div class="form-group">
          <label for="leaderName">ì´ë¦„</label>
          <input type="text" id="leaderName" placeholder="ì˜ˆ) ê¹€ì² ìˆ˜" />
        </div>

        <div class="form-group">
          <label for="leaderRole">ì—­í•  / ì§í•¨</label>
          <input type="text" id="leaderRole" placeholder="ì˜ˆ) ë² íŠ¸ë‚¨ ì¥ê¸° ì²´ë¥˜ ë¦¬ë” Â· 10ë…„ ì°¨ ê°€ì´ë“œ" />
        </div>

        <div class="form-group">
          <label for="leaderLink">ìƒë‹´ / ì‹ ì²­ ë§í¬ (êµ¬ê¸€í¼ URL)</label>
          <input type="text" id="leaderLink" placeholder="ì˜ˆ) https://docs.google.com/forms/..." />
        </div>

        <div class="form-group">
          <label for="leaderSheetUrl">ì‘ë‹µ ì‹œíŠ¸ ë§í¬ (êµ¬ê¸€ ì‹œíŠ¸ URL)</label>
          <input type="text" id="leaderSheetUrl" placeholder="ì˜ˆ) https://docs.google.com/spreadsheets/..." />
        </div>

        <div class="form-group">
          <label for="leaderTags">í‚¤ì›Œë“œ íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
          <input type="text" id="leaderTags" placeholder="ì˜ˆ) ì¥ê¸° ì²´ë¥˜, ë¡œì»¬ ìƒí™œ, ë£¨í‹´ ì—¬í–‰" />
        </div>

        <div class="form-group">
          <label for="leaderIntro">í•œ ì¤„ ì†Œê°œ / ì§§ì€ ì„¤ëª…</label>
          <textarea id="leaderIntro" placeholder="ì˜ˆ) ì—¬í–‰ì´ ì•„ë‹ˆë¼ â€˜ì‚´ì•„ë³´ëŠ” ì‹œê°„â€™ì„ ì„¤ê³„í•©ë‹ˆë‹¤. ìµœì†Œ 1ê°œì›” ì´ìƒ ë¨¸ë¬´ëŠ” ë£¨íŠ¸ë¥¼ í•¨ê»˜ ì§­ë‹ˆë‹¤."></textarea>
        </div>

        <div class="section-label">ë¦¬ë”ë³„ SNS ì±„ë„</div>
        <div class="form-group">
          <label for="leaderYoutube">YouTube URL</label>
          <input type="text" id="leaderYoutube" placeholder="https://www.youtube.com/@leaderchannel" />
        </div>
        <div class="form-group">
          <label for="leaderTiktok">TikTok URL</label>
          <input type="text" id="leaderTiktok" placeholder="https://www.tiktok.com/@leaderid" />
        </div>
        <div class="form-group">
          <label for="leaderInstagram">Instagram URL</label>
          <input type="text" id="leaderInstagram" placeholder="https://www.instagram.com/leaderid" />
        </div>
        <div class="form-group">
          <label for="leaderFacebook">Facebook URL</label>
          <input type="text" id="leaderFacebook" placeholder="https://www.facebook.com/leaderpage" />
        </div>
        <div class="form-group">
          <label for="leaderBlog">Blog URL</label>
          <input type="text" id="leaderBlog" placeholder="https://blog.naver.com/leader" />
        </div>
        <div class="form-group">
          <label for="leaderCarrot">ë‹¹ê·¼ URL</label>
          <input type="text" id="leaderCarrot" placeholder="https://www.daangn.com/..." />
        </div>
        <div class="form-group">
          <label for="leaderDiscord">Discord URL</label>
          <input type="text" id="leaderDiscord" placeholder="https://discord.gg/..." />
        </div>

        <div class="form-group">
          <label>í”„ë¡œí•„ ì´ë¯¸ì§€ (ì´ë¯¸ì§€ íŒŒì¼)</label>
          <input type="file" id="leaderMediaFile" accept="image/*" />
          <small>íŒŒì¼ ì„ íƒ ë˜ëŠ” ì•„ë˜ ì˜ì—­ì— ë“œë˜ê·¸ ì•¤ ë“œë¡­ (ì´ë¯¸ì§€ ì „ìš©).</small>
          <div id="leaderDropZone" class="drop-zone">
            ì—¬ê¸°ë¡œ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”.
          </div>
          <div id="leaderPreviewWrap" class="preview-wrap">
            <img id="leaderPreviewImage" src="" alt="ë¦¬ë” ë¯¸ë¦¬ë³´ê¸°" />
          </div>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="leaderEnabled" checked /> ì´ ë¦¬ë” ë…¸ì¶œ
          </label>
          <small>ì²´í¬ í•´ì œí•˜ë©´ ê³µê°œ í˜ì´ì§€ì—ì„œ ì´ ë¦¬ë” ì¹´ë“œê°€ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.</small>
        </div>

        <div class="form-group inline" style="margin-top:4px;">
          <button class="btn btn-primary" id="saveLeaderBtn">ë¦¬ë” ì €ì¥</button>
          <button class="btn btn-secondary" id="clearLeaderFormBtn">ë¦¬ë” í¼ ì´ˆê¸°í™”</button>
        </div>
      </div>

      <!-- ìš°ì¸¡: ë¦¬ë” ë¦¬ìŠ¤íŠ¸ + JSON -->
      <div class="admin-card">
        <div class="admin-title-row">
          <div class="admin-title" style="margin-bottom:0;">ë¦¬ë” ë¦¬ìŠ¤íŠ¸</div>
          <button class="btn-new-leader" id="newLeaderBtn">+ ìƒˆ ë¦¬ë” ì¶”ê°€</button>
        </div>
        <div class="leader-list" id="leaderList"></div>
        <hr style="margin:10px 0;" />
        <div class="admin-title" style="margin-top:4px;">leaders.json ìƒì„± / ë¶ˆëŸ¬ì˜¤ê¸° / ë³µì‚¬</div>
        <div style="display:flex;gap:8px;margin-bottom:6px;flex-wrap:wrap;">
          <button class="btn btn-primary" id="generateJsonBtn">JSON ìƒì„±í•˜ê¸°</button>
          <button class="btn btn-secondary" id="copyJsonBtn">JSON ë³µì‚¬í•˜ê¸°</button>
          <button class="btn btn-outline" id="downloadJsonBtn">ì„ì‹œ JSON ì €ì¥(íŒŒì¼)</button>
          <button class="btn btn-outline" id="loadJsonBtn">JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° â†’ ê´€ë¦¬ì ë°˜ì˜</button>
          <button class="btn btn-outline" id="openJsonBtn">GitHub leaders.json ì—´ê¸°</button>
        </div>

        <!-- ğŸ” êµ¬ê¸€í¼ URL ì¼ê´„ ì…ë ¥ ì˜ì—­ -->
        <div class="form-group">
          <label class="section-label" for="bulk-form-urls">
            ìƒë‹´ / ì‹ ì²­ êµ¬ê¸€í¼ URL ì¼ê´„ ì…ë ¥ (ê° ì¤„ë§ˆë‹¤ 1ê°œ URL)
          </label>
          <textarea
            id="bulk-form-urls"
            class="json-area"
            style="min-height: 80px;"
            placeholder="https://docs.google.com/forms/...=í•œê¸°ë¦¼&#10;https://docs.google.com/forms/...=ì„ì •ì• &#10;https://docs.google.com/forms/...=ìœ¤ì§€ë¯¼&#10;..."
          ></textarea>
          <div class="inline" style="margin-top:6px;">
            <button id="apply-bulk-form-urls" class="btn btn-outline btn-xs" type="button">
              URL â†’ ë¦¬ë”ì— ìë™ ë§¤ì¹­
            </button>
            <small id="bulk-form-urls-status"></small>
          </div>
        </div>

        <textarea id="jsonOutput" class="json-area" placeholder="ì—¬ê¸°ì— leaders.json ë‚´ìš©ì´ ìƒì„±ë©ë‹ˆë‹¤."></textarea>
        <input type="file" id="jsonFileInput" accept="application/json,.json" style="display:none;" />
        <div class="help-box">
          <b>[GitHubì— ë¶™ì—¬ ë„£ëŠ” ë°©ë²•]</b><br />
          1) ìœ„ì—ì„œ ì—¬í–‰ ìŠ¤ì¼€ì¤„ + ê´‘ê³  + ë¦¬ë”ë“¤ì„ ëª¨ë‘ ì›í•˜ëŠ” ëŒ€ë¡œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œí•œ ë’¤, <b>JSON ìƒì„±í•˜ê¸°</b> ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.<br />
          2) <b>JSON ë³µì‚¬í•˜ê¸°</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ leaders.json ë‚´ìš©ì„ í´ë¦½ë³´ë“œì— ë³µì‚¬í•©ë‹ˆë‹¤.<br />
          3) <b>GitHub leaders.json ì—´ê¸°</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ GitHubì˜ leaders.json íŒŒì¼ í¸ì§‘ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.<br />
          4) GitHubì—ì„œ ë‚´ìš© ì „ì²´ ì„ íƒ(Ctrl+A) í›„ ì‚­ì œ â†’ ë³µì‚¬í•œ JSONì„ ë¶™ì—¬ ë„£ê¸°(Ctrl+V).<br />
          5) ì•„ë˜ìª½ <b>Commit changes</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥.<br />
          6) ê³µê°œ í˜ì´ì§€(<code>https://wordycow.github.io/so.t-leader-choice/</code>)ì—ì„œ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ëª¨ë“  ì‚¬ìš©ìê°€ ë™ì¼í•˜ê²Œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.<br/><br/>
          â€» ì´ë¯¸ ë§Œë“¤ì–´ì§„ leaders.jsonì„ ë‹¤ì‹œ í¸ì§‘í•˜ë ¤ë©´, GitHubì—ì„œ Raw â†’ <b>Download</b>ë¡œ íŒŒì¼ì„ ì €ì¥í•œ ë’¤<br/>
          &nbsp;&nbsp;ìœ„ì˜ <b>JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° â†’ ê´€ë¦¬ì ë°˜ì˜</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¶ˆëŸ¬ì˜¤ë©´ ë©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const DRAFT_KEY = "so_t_leaders_trip_ads_draft_v1";

  function getDefaultData() {
    return {
      tripAds: [],
      ads: [],
      leaders: []
    };
  }

  function loadDraft() {
    try {
      const raw = localStorage.getItem(DRAFT_KEY);
      if (!raw) return getDefaultData();
      const parsed = JSON.parse(raw);
      if (!parsed || typeof parsed !== "object") return getDefaultData();

      if (!Array.isArray(parsed.tripAds)) parsed.tripAds = [];
      if (!Array.isArray(parsed.ads))     parsed.ads     = [];
      if (!Array.isArray(parsed.leaders)) parsed.leaders = [];

      parsed.tripAds.forEach(a => {
        if (typeof a.enabled !== "boolean") a.enabled = true;
      });
      parsed.ads.forEach(a => {
        if (typeof a.enabled !== "boolean") a.enabled = true;
      });
      parsed.leaders.forEach(l => {
        if (!l.sns) l.sns = { youtube:"", tiktok:"", instagram:"", facebook:"", blog:"", carrot:"", discord:"" };
        if (typeof l.enabled !== "boolean") l.enabled = true;
      });

      return parsed;
    } catch {
      return getDefaultData();
    }
  }

  function saveDraft() {
    const snapshot = { tripAds, ads, leaders };
    localStorage.setItem(DRAFT_KEY, JSON.stringify(snapshot));
  }

  let data     = loadDraft();
  let tripAds  = data.tripAds;
  let ads      = data.ads;
  let leaders  = data.leaders;

  // === DOM ìš”ì†Œ ===

  // ì—¬í–‰ ìŠ¤ì¼€ì¤„
  const editingTripIndexEl = document.getElementById("editingTripIndex");
  const tripLinkInput      = document.getElementById("tripLinkUrl");
  const tripTextInput      = document.getElementById("tripText");
  const tripEnabledInput   = document.getElementById("tripEnabled");
  const tripImageInput     = document.getElementById("tripImageFile");
  const tripDropZone       = document.getElementById("tripDropZone");
  const tripPreviewWrap    = document.getElementById("tripPreviewWrap");
  const tripPreviewImage   = document.getElementById("tripPreviewImage");
  const tripListEl         = document.getElementById("tripList");
  const saveTripBtn        = document.getElementById("saveTripBtn");
  const clearTripFormBtn   = document.getElementById("clearTripFormBtn");
  const newTripBtn         = document.getElementById("newTripBtn");

  // ê´‘ê³ 
  const editingAdIndexEl   = document.getElementById("editingAdIndex");
  const adLinkInput        = document.getElementById("adLinkUrl");
  const adTextInput        = document.getElementById("adText");
  const adEnabledInput     = document.getElementById("adEnabled");
  const adImageInput       = document.getElementById("adImageFile");
  const adDropZone         = document.getElementById("adDropZone");
  const adPreviewWrap      = document.getElementById("adPreviewWrap");
  const adPreviewImage     = document.getElementById("adPreviewImage");
  const adListEl           = document.getElementById("adList");
  const saveAdBtn          = document.getElementById("saveAdBtn");
  const clearAdFormBtn     = document.getElementById("clearAdFormBtn");
  const newAdBtn           = document.getElementById("newAdBtn");

  // JSON ê´€ë ¨
  const jsonOutput      = document.getElementById("jsonOutput");
  const generateJsonBtn = document.getElementById("generateJsonBtn");
  const copyJsonBtn     = document.getElementById("copyJsonBtn");
  const downloadJsonBtn = document.getElementById("downloadJsonBtn");
  const openJsonBtn     = document.getElementById("openJsonBtn");
  const loadJsonBtn     = document.getElementById("loadJsonBtn");
  const jsonFileInput   = document.getElementById("jsonFileInput");

  // URL ì¼ê´„ ì…ë ¥
  const bulkTextarea = document.getElementById("bulk-form-urls");
  const bulkBtn      = document.getElementById("apply-bulk-form-urls");
  const bulkStatus   = document.getElementById("bulk-form-urls-status");

  // ë¦¬ë”
  const editingLeaderIndexEl = document.getElementById("editingLeaderIndex");
  const leaderListEl         = document.getElementById("leaderList");
  const leaderNameInput      = document.getElementById("leaderName");
  const leaderRoleInput      = document.getElementById("leaderRole");
  const leaderLinkInput      = document.getElementById("leaderLink");
  const leaderSheetInput     = document.getElementById("leaderSheetUrl");
  const leaderTagsInput      = document.getElementById("leaderTags");
  const leaderIntroInput     = document.getElementById("leaderIntro");
  const leaderYoutubeInput   = document.getElementById("leaderYoutube");
  const leaderTiktokInput    = document.getElementById("leaderTiktok");
  const leaderInstagramInput = document.getElementById("leaderInstagram");
  const leaderFacebookInput  = document.getElementById("leaderFacebook");
  const leaderBlogInput      = document.getElementById("leaderBlog");
  const leaderCarrotInput    = document.getElementById("leaderCarrot");
  const leaderDiscordInput   = document.getElementById("leaderDiscord");
  const leaderMediaInput     = document.getElementById("leaderMediaFile");
  const leaderDropZone       = document.getElementById("leaderDropZone");
  const leaderPreviewWrap    = document.getElementById("leaderPreviewWrap");
  const leaderPreviewImage   = document.getElementById("leaderPreviewImage");
  const leaderEnabledInput   = document.getElementById("leaderEnabled");
  const newLeaderBtn         = document.getElementById("newLeaderBtn");
  const clearLeaderFormBtn   = document.getElementById("clearLeaderFormBtn");

  let tempTripImageDataUrl  = "";
  let tempAdImageDataUrl    = "";
  let tempLeaderMediaDataUrl= "";

  // ==== ì—¬í–‰ ìŠ¤ì¼€ì¤„ í•¨ìˆ˜ ====

  function clearTripPreview() {
    tripPreviewWrap.style.display = "none";
    tripPreviewImage.src = "";
    tempTripImageDataUrl = "";
  }

  function clearTripForm() {
    editingTripIndexEl.value = -1;
    tripLinkInput.value      = "";
    tripTextInput.value      = "";
    tripEnabledInput.checked = true;
    tripImageInput.value     = "";
    clearTripPreview();
  }

  function showTripPreview(dataUrl) {
    tempTripImageDataUrl = dataUrl;
    tripPreviewImage.src = dataUrl;
    tripPreviewWrap.style.display = "block";
  }

  function handleTripFile(file) {
    if (!file) return;
    if (!file.type.startsWith("image/")) {
      alert("ì—¬í–‰ ìŠ¤ì¼€ì¤„ ì´ë¯¸ì§€ëŠ” ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      return;
    }
    const reader = new FileReader();
    reader.onload = e => showTripPreview(e.target.result);
    reader.readAsDataURL(file);
  }

  tripImageInput.addEventListener("change", function() {
    const file = this.files[0];
    handleTripFile(file);
  });

  ["dragenter","dragover"].forEach(evt => {
    tripDropZone.addEventListener(evt, e => {
      e.preventDefault(); e.stopPropagation();
      tripDropZone.classList.add("dragover");
    });
  });
  ["dragleave","drop"].forEach(evt => {
    tripDropZone.addEventListener(evt, e => {
      e.preventDefault(); e.stopPropagation();
      tripDropZone.classList.remove("dragover");
    });
  });
  tripDropZone.addEventListener("drop", e => {
    const file = e.dataTransfer.files[0];
    handleTripFile(file);
  });

  clearTripFormBtn.addEventListener("click", clearTripForm);
  newTripBtn.addEventListener("click", clearTripForm);

  saveTripBtn.addEventListener("click", () => {
    const linkUrl = tripLinkInput.value.trim();
    const text    = tripTextInput.value.trim();
    const enabled = tripEnabledInput.checked;
    const idx     = parseInt(editingTripIndexEl.value, 10);
    const base    = { linkUrl, text, enabled };

    if (idx >= 0) {
      const prev = tripAds[idx];
      tripAds[idx] = {
        ...prev,
        ...base,
        imageUrl: tempTripImageDataUrl || prev.imageUrl || ""
      };
    } else {
      if (!tempTripImageDataUrl) {
        alert("ì—¬í–‰ ìŠ¤ì¼€ì¤„ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }
      tripAds.push({ ...base, imageUrl: tempTripImageDataUrl });
    }

    data.tripAds = tripAds;
    saveDraft();
    renderTripAds();
    alert("ì—¬í–‰ ìŠ¤ì¼€ì¤„ì´ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. JSON ìƒì„±í•˜ê¸° â†’ leaders.json ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.");
  });

  function renderTripAds() {
    tripListEl.innerHTML = "";
    if (!tripAds.length) {
      tripListEl.innerHTML = "<p style='font-size:12px;color:#6b7280;'>ë“±ë¡ëœ ì—¬í–‰ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    tripAds.forEach((ad, index) => {
      const item = document.createElement("div");
      item.className = "trip-item";

      const enableBadge = ad.enabled
        ? `<span class="enable-badge enable-yes">ë…¸ì¶œ</span>`
        : `<span class="enable-badge enable-no">ë¹„ë…¸ì¶œ</span>`;
      const toggleBtnClass = ad.enabled ? "btn btn-primary btn-xs" : "btn btn-outline btn-xs";
      const toggleBtnLabel = ad.enabled ? "ë…¸ì¶œ ë„ê¸°" : "ë…¸ì¶œ ì¼œê¸°";

      const orderNo  = index + 1;
      const thumbHtml = ad.imageUrl
        ? `<img src="${ad.imageUrl}" class="trip-thumb" alt="">`
        : "";

      item.innerHTML = `
        <div class="trip-item-header">
          <div style="display:flex;align-items:center;">
            ${thumbHtml}
            <div>
              <div class="trip-item-title">
                [${orderNo}] ${ad.text || "(ì œëª© ì—†ìŒ)"} ${enableBadge}
              </div>
              <div style="font-size:11px;color:#6b7280;">
                ${ad.text ? "ë¬¸êµ¬: " + ad.text : "<span style='color:#9ca3af;'>ë¬¸êµ¬ ì—†ìŒ</span>"}
              </div>
              ${
                ad.linkUrl
                  ? `<a href="${ad.linkUrl}" target="_blank" rel="noopener noreferrer" class="link-small">${ad.linkUrl}</a>`
                  : "<span class='link-small' style='color:#9ca3af;text-decoration:none;'>ë§í¬ ì—†ìŒ</span>"
              }
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
            <div>
              <button class="${toggleBtnClass}" onclick="toggleTripEnable(${index})">${toggleBtnLabel}</button>
              <button class="btn btn-secondary btn-xs" onclick="editTrip(${index})">ìˆ˜ì •</button>
              <button class="btn btn-danger btn-xs" onclick="deleteTrip(${index})">ì‚­ì œ</button>
            </div>
            <div>
              <button class="btn btn-outline btn-xs" onclick="moveTripUp(${index})" ${index===0 ? "disabled" : ""}>â–² ìœ„ë¡œ</button>
              <button class="btn btn-outline btn-xs" onclick="moveTripDown(${index})" ${index===tripAds.length-1 ? "disabled" : ""}>â–¼ ì•„ë˜ë¡œ</button>
            </div>
          </div>
        </div>
      `;
      tripListEl.appendChild(item);
    });
  }

  window.editTrip = function(index) {
    const ad = tripAds[index];
    editingTripIndexEl.value = index;
    tripLinkInput.value      = ad.linkUrl || "";
    tripTextInput.value      = ad.text || "";
    tripEnabledInput.checked = !!ad.enabled;
    tempTripImageDataUrl     = ad.imageUrl || "";
    if (tempTripImageDataUrl) showTripPreview(tempTripImageDataUrl);
    else clearTripPreview();
  };

  window.deleteTrip = function(index) {
    if (!confirm("ì´ ì—¬í–‰ ìŠ¤ì¼€ì¤„ì„ ì‚­ì œí• ê¹Œìš”?")) return;
    tripAds.splice(index, 1);
    data.tripAds = tripAds;
    saveDraft();
    renderTripAds();
    clearTripForm();
  };

  window.toggleTripEnable = function(index) {
    tripAds[index].enabled = !tripAds[index].enabled;
    data.tripAds = tripAds;
    saveDraft();
    renderTripAds();
  };

  window.moveTripUp = function(index) {
    if (index <= 0) return;
    const tmp = tripAds[index-1];
    tripAds[index-1] = tripAds[index];
    tripAds[index]   = tmp;
    data.tripAds = tripAds;
    saveDraft();
    renderTripAds();
  };

  window.moveTripDown = function(index) {
    if (index >= tripAds.length-1) return;
    const tmp = tripAds[index+1];
    tripAds[index+1] = tripAds[index];
    tripAds[index]   = tmp;
    data.tripAds = tripAds;
    saveDraft();
    renderTripAds();
  };

  // ==== ê´‘ê³  í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§) ====

  function clearAdPreview() {
    adPreviewWrap.style.display = "none";
    adPreviewImage.src = "";
    tempAdImageDataUrl = "";
  }

  function clearAdForm() {
    editingAdIndexEl.value = -1;
    adLinkInput.value      = "";
    adTextInput.value      = "";
    adEnabledInput.checked = true;
    adImageInput.value     = "";
    clearAdPreview();
  }

  function showAdPreview(dataUrl) {
    tempAdImageDataUrl = dataUrl;
    adPreviewImage.src = dataUrl;
    adPreviewWrap.style.display = "block";
  }

  function handleAdFile(file) {
    if (!file) return;
    if (!file.type.startsWith("image/")) {
      alert("ê´‘ê³  ì´ë¯¸ì§€ëŠ” ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      return;
    }
    const reader = new FileReader();
    reader.onload = (e) => showAdPreview(e.target.result);
    reader.readAsDataURL(file);
  }

  adImageInput.addEventListener("change", function () {
    const file = this.files[0];
    handleAdFile(file);
  });

  ["dragenter","dragover"].forEach((evt) => {
    adDropZone.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      adDropZone.classList.add("dragover");
    });
  });
  ["dragleave","drop"].forEach((evt) => {
    adDropZone.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      adDropZone.classList.remove("dragover");
    });
  });
  adDropZone.addEventListener("drop", (e) => {
    const file = e.dataTransfer.files[0];
    handleAdFile(file);
  });

  clearAdFormBtn.addEventListener("click", clearAdForm);
  newAdBtn.addEventListener("click", clearAdForm);

  saveAdBtn.addEventListener("click", () => {
    const linkUrl  = adLinkInput.value.trim();
    const text     = adTextInput.value.trim();
    const enabled  = adEnabledInput.checked;
    const idx      = parseInt(editingAdIndexEl.value, 10);
    const base     = { linkUrl, text, enabled };

    if (idx >= 0) {
      const prev = ads[idx];
      ads[idx] = {
        ...prev,
        ...base,
        imageUrl: tempAdImageDataUrl || prev.imageUrl || ""
      };
    } else {
      if (!tempAdImageDataUrl) {
        alert("ê´‘ê³  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }
      ads.push({ ...base, imageUrl: tempAdImageDataUrl });
    }

    data.ads = ads;
    saveDraft();
    renderAds();
    alert("ê´‘ê³ ê°€ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. JSON ìƒì„±í•˜ê¸° â†’ leaders.json ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.");
  });

  function renderAds() {
    adListEl.innerHTML = "";
    if (!ads.length) {
      adListEl.innerHTML = "<p style='font-size:12px;color:#6b7280;'>ë“±ë¡ëœ ê´‘ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    ads.forEach((ad, index) => {
      const item = document.createElement("div");
      item.className = "ad-item";

      const enableBadge = ad.enabled
        ? `<span class="enable-badge enable-yes">ë…¸ì¶œ</span>`
        : `<span class="enable-badge enable-no">ë¹„ë…¸ì¶œ</span>`;

      const toggleBtnClass = ad.enabled
        ? "btn btn-primary btn-xs"
        : "btn btn-outline btn-xs";

      const toggleBtnLabel = ad.enabled ? "ë…¸ì¶œ ë„ê¸°" : "ë…¸ì¶œ ì¼œê¸°";

      const orderNo  = index + 1;
      const thumbHtml = ad.imageUrl
        ? `<img src="${ad.imageUrl}" class="ad-thumb" alt="">`
        : "";

      item.innerHTML = `
        <div class="ad-item-header">
          <div style="display:flex;align-items:center;">
            ${thumbHtml}
            <div>
              <div class="ad-item-title">
                [${orderNo}] ${ad.text || "(ì œëª© ì—†ìŒ)"} ${enableBadge}
              </div>
              <div style="font-size:11px;color:#6b7280;">
                ${ad.text ? "ë¬¸êµ¬: " + ad.text : "<span style='color:#9ca3af;'>ë¬¸êµ¬ ì—†ìŒ</span>"}
              </div>
              ${
                ad.linkUrl
                  ? `<a href="${ad.linkUrl}" target="_blank" rel="noopener noreferrer" class="link-small">${ad.linkUrl}</a>`
                  : "<span class='link-small' style='color:#9ca3af;text-decoration:none;'>ë§í¬ ì—†ìŒ</span>"
              }
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
            <div>
              <button class="${toggleBtnClass}" onclick="toggleAdEnable(${index})">
                ${toggleBtnLabel}
              </button>
              <button class="btn btn-secondary btn-xs" onclick="editAd(${index})">ìˆ˜ì •</button>
              <button class="btn btn-danger btn-xs" onclick="deleteAd(${index})">ì‚­ì œ</button>
            </div>
            <div>
              <button class="btn btn-outline btn-xs" onclick="moveAdUp(${index})" ${index===0 ? "disabled" : ""}>â–² ìœ„ë¡œ</button>
              <button class="btn btn-outline btn-xs" onclick="moveAdDown(${index})" ${index===ads.length-1 ? "disabled" : ""}>â–¼ ì•„ë˜ë¡œ</button>
            </div>
          </div>
        </div>
      `;
      adListEl.appendChild(item);
    });
  }

  window.editAd = function (index) {
    const ad = ads[index];
    editingAdIndexEl.value = index;
    adLinkInput.value      = ad.linkUrl || "";
    adTextInput.value      = ad.text || "";
    adEnabledInput.checked = !!ad.enabled;
    tempAdImageDataUrl     = ad.imageUrl || "";
    if (tempAdImageDataUrl) showAdPreview(tempAdImageDataUrl);
    else clearAdPreview();
  };

  window.deleteAd = function (index) {
    if (!confirm("ì´ ê´‘ê³ ë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
    ads.splice(index, 1);
    data.ads = ads;
    saveDraft();
    renderAds();
    clearAdForm();
  };

  window.toggleAdEnable = function (index) {
    ads[index].enabled = !ads[index].enabled;
    data.ads = ads;
    saveDraft();
    renderAds();
  };

  window.moveAdUp = function(index) {
    if (index <= 0) return;
    const tmp = ads[index-1];
    ads[index-1] = ads[index];
    ads[index]   = tmp;
    data.ads = ads;
    saveDraft();
    renderAds();
  };

  window.moveAdDown = function(index) {
    if (index >= ads.length-1) return;
    const tmp = ads[index+1];
    ads[index+1] = ads[index];
    ads[index]   = tmp;
    data.ads = ads;
    saveDraft();
    renderAds();
  };

  // ==== ë¦¬ë” ê´€ë ¨ ====

  function clearLeaderPreview() {
    leaderPreviewWrap.style.display = "none";
    leaderPreviewImage.src = "";
    tempLeaderMediaDataUrl = "";
  }

  function clearLeaderForm() {
    editingLeaderIndexEl.value = -1;
    leaderNameInput.value      = "";
    leaderRoleInput.value      = "";
    leaderLinkInput.value      = "";
    leaderSheetInput.value     = "";
    leaderTagsInput.value      = "";
    leaderIntroInput.value     = "";
    leaderYoutubeInput.value   = "";
    leaderTiktokInput.value    = "";
    leaderInstagramInput.value = "";
    leaderFacebookInput.value  = "";
    leaderBlogInput.value      = "";
    leaderCarrotInput.value    = "";
    leaderDiscordInput.value   = "";
    leaderMediaInput.value     = "";
    leaderEnabledInput.checked = true;
    clearLeaderPreview();
  }

  clearLeaderFormBtn.addEventListener("click", clearLeaderForm);
  newLeaderBtn.addEventListener("click", clearLeaderForm);

  leaderMediaInput.addEventListener("change", function () {
    const file = this.files[0];
    handleLeaderFile(file);
  });

  ["dragenter","dragover"].forEach((evt) => {
    leaderDropZone.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      leaderDropZone.classList.add("dragover");
    });
  });
  ["dragleave","drop"].forEach((evt) => {
    leaderDropZone.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      leaderDropZone.classList.remove("dragover");
    });
  });
  leaderDropZone.addEventListener("drop", (e) => {
    const file = e.dataTransfer.files[0];
    handleLeaderFile(file);
  });

  function handleLeaderFile(file) {
    if (!file) return;
    if (!file.type.startsWith("image/")) {
      alert("í”„ë¡œí•„ ì´ë¯¸ì§€ëŠ” ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      return;
    }
    const reader = new FileReader();
    reader.onload = (e) => showLeaderPreview(e.target.result);
    reader.readAsDataURL(file);
  }

  function showLeaderPreview(dataUrl) {
    tempLeaderMediaDataUrl = dataUrl;
    leaderPreviewImage.src = dataUrl;
    leaderPreviewWrap.style.display = "block";
  }

  document.getElementById("saveLeaderBtn").addEventListener("click", () => {
    const name = leaderNameInput.value.trim();
    if (!name) {
      alert("ë¦¬ë” ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
      return;
    }

    const role      = leaderRoleInput.value.trim();
    const link      = leaderLinkInput.value.trim();
    const sheetUrl  = leaderSheetInput.value.trim();
    const tags      = leaderTagsInput.value.split(",").map((t) => t.trim()).filter(Boolean);
    const introShort= leaderIntroInput.value.trim();
    const sns = {
      youtube:   leaderYoutubeInput.value.trim(),
      tiktok:    leaderTiktokInput.value.trim(),
      instagram: leaderInstagramInput.value.trim(),
      facebook:  leaderFacebookInput.value.trim(),
      blog:      leaderBlogInput.value.trim(),
      carrot:    leaderCarrotInput.value.trim(),
      discord:   leaderDiscordInput.value.trim()
    };
    const enabled   = leaderEnabledInput.checked;
    const idx       = parseInt(editingLeaderIndexEl.value, 10);
    const base      = { name, role, link, sheetUrl, tags, introShort, sns, enabled };

    if (idx >= 0) {
      const prev = leaders[idx];
      leaders[idx] = {
        ...prev,
        ...base,
        mediaUrl: tempLeaderMediaDataUrl || prev.mediaUrl || prev.imageUrl || ""
      };
    } else {
      leaders.push({
        ...base,
        mediaUrl: tempLeaderMediaDataUrl || ""
      });
    }

    data.leaders = leaders;
    saveDraft();
    renderLeaders();
    alert("ë¦¬ë”ê°€ ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. JSON ìƒì„±í•˜ê¸° â†’ leaders.json ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.");
    clearLeaderForm();
  });

  window.editLeader = function (index) {
    const l = leaders[index];
    editingLeaderIndexEl.value = index;
    leaderNameInput.value      = l.name || "";
    leaderRoleInput.value      = l.role || "";
    leaderLinkInput.value      = l.link || "";
    leaderSheetInput.value     = l.sheetUrl || "";
    leaderTagsInput.value      = (l.tags || []).join(", ");
    leaderIntroInput.value     = l.introShort || "";
    const sns = l.sns || {};
    leaderYoutubeInput.value   = sns.youtube   || "";
    leaderTiktokInput.value    = sns.tiktok    || "";
    leaderInstagramInput.value = sns.instagram || "";
    leaderFacebookInput.value  = sns.facebook  || "";
    leaderBlogInput.value      = sns.blog      || "";
    leaderCarrotInput.value    = sns.carrot    || "";
    leaderDiscordInput.value   = sns.discord   || "";
    leaderEnabledInput.checked = l.enabled !== false;
    tempLeaderMediaDataUrl     = l.mediaUrl || l.imageUrl || "";
    if (tempLeaderMediaDataUrl) showLeaderPreview(tempLeaderMediaDataUrl);
    else clearLeaderPreview();
    leaderMediaInput.value = "";
  };

  window.deleteLeader = function (index) {
    if (!confirm("ì´ ë¦¬ë”ë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
    leaders.splice(index, 1);
    data.leaders = leaders;
    saveDraft();
    renderLeaders();
    clearLeaderForm();
  };

  window.toggleLeaderEnable = function (index) {
    leaders[index].enabled = !leaders[index].enabled;
    data.leaders = leaders;
    saveDraft();
    renderLeaders();
  };

  // ë¦¬ë” ë¦¬ìŠ¤íŠ¸ + ìˆœì„œ
  function renderLeaders() {
    leaderListEl.innerHTML = "";
    if (!leaders.length) {
      leaderListEl.innerHTML = "<p style='font-size:12px;color:#6b7280;'>ë“±ë¡ëœ ë¦¬ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    leaders.forEach((leader, index) => {
      const sns = leader.sns || {};
      const snsParts = [];
      if (sns.youtube)   snsParts.push("YouTube");
      if (sns.tiktok)    snsParts.push("TikTok");
      if (sns.instagram) snsParts.push("Instagram");
      if (sns.facebook)  snsParts.push("Facebook");
      if (sns.blog)      snsParts.push("Blog");
      if (sns.carrot)    snsParts.push("ë‹¹ê·¼");
      if (sns.discord)   snsParts.push("Discord");

      const thumbHtml = leader.mediaUrl || leader.imageUrl
        ? `<img src="${leader.mediaUrl || leader.imageUrl}" class="thumb" alt="">`
        : `<div class="leader-thumb-slot">ì´ë¯¸ì§€</div>`;

      const sheetLinkHtml = leader.sheetUrl
        ? `<a href="${leader.sheetUrl}" target="_blank" rel="noopener noreferrer" class="link-small">ì‘ë‹µ ì‹œíŠ¸ ì—´ê¸°</a>`
        : "<span style='font-size:10px;color:#9ca3af;'>ì‘ë‹µ ì‹œíŠ¸ ë§í¬ ì—†ìŒ</span>";

      const enabled = leader.enabled !== false;
      const enableBadge = enabled
        ? `<span class="enable-badge enable-yes">ë…¸ì¶œ</span>`
        : `<span class="enable-badge enable-no">ë¹„ë…¸ì¶œ</span>`;
      const toggleBtnClass = enabled ? "btn btn-primary btn-xs" : "btn btn-outline btn-xs";
      const toggleBtnLabel = enabled ? "ë…¸ì¶œ ë„ê¸°" : "ë…¸ì¶œ ì¼œê¸°";

      const orderNo = index + 1;

      const item = document.createElement("div");
      item.className = "leader-item";
      item.innerHTML = `
        <div class="leader-item-header">
          <div style="display:flex;align-items:center;">
            ${thumbHtml}
            <div>
              <div class="leader-item-name">
                [${orderNo}] ${leader.name || "(ì´ë¦„ ì—†ìŒ)"} ${enableBadge}
              </div>
              <div style="font-size:11px;color:#6b7280;">${leader.role || ""}</div>
              ${
                leader.link
                  ? `<a href="${leader.link}" target="_blank" rel="noopener noreferrer" class="link-small">${leader.link}</a>`
                  : "<span class='link-small' style='color:#9ca3af;text-decoration:none;'>ìƒë‹´ ë§í¬ ì—†ìŒ</span>"
              }
              <br />
              ${sheetLinkHtml}
              ${
                snsParts.length
                  ? `<div style="font-size:10px;color:#6b7280;margin-top:2px;">SNS: ${snsParts.join(", ")}</div>`
                  : ""
              }
              <div style="font-size:10px;color:#9ca3af;margin-top:2px;">
                íƒœê·¸: ${(leader.tags || []).join(", ") || "-"}
              </div>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
            <div>
              <button class="${toggleBtnClass}" onclick="toggleLeaderEnable(${index})">${toggleBtnLabel}</button>
              <button class="btn btn-secondary btn-xs" onclick="editLeader(${index})">ìˆ˜ì •</button>
              <button class="btn btn-danger btn-xs" onclick="deleteLeader(${index})">ì‚­ì œ</button>
            </div>
            <div>
              <button class="btn btn-outline btn-xs" onclick="moveLeaderUp(${index})" ${index===0 ? "disabled" : ""}>â–² ìœ„ë¡œ</button>
              <button class="btn btn-outline btn-xs" onclick="moveLeaderDown(${index})" ${index===leaders.length-1 ? "disabled" : ""}>â–¼ ì•„ë˜ë¡œ</button>
            </div>
          </div>
        </div>
      `;
      leaderListEl.appendChild(item);
    });
  }

  window.moveLeaderUp = function(index) {
    if (index <= 0) return;
    const tmp = leaders[index-1];
    leaders[index-1] = leaders[index];
    leaders[index] = tmp;
    data.leaders = leaders;
    saveDraft();
    renderLeaders();
  };

  window.moveLeaderDown = function(index) {
    if (index >= leaders.length-1) return;
    const tmp = leaders[index+1];
    leaders[index+1] = leaders[index];
    leaders[index] = tmp;
    data.leaders = leaders;
    saveDraft();
    renderLeaders();
  };

  // ==== JSON ìƒì„±/ë³µì‚¬/ë¶ˆëŸ¬ì˜¤ê¸° ====

  generateJsonBtn.addEventListener("click", () => {
    const exportTripAds = tripAds.map((ad, idx) => ({
      linkUrl: ad.linkUrl || "",
      text:    ad.text    || "",
      enabled: ad.enabled !== false,
      imageUrl: ad.imageUrl || "",
      order:   idx + 1
    }));

    const exportAds = ads.map((ad, idx) => ({
      linkUrl: ad.linkUrl || "",
      text:    ad.text    || "",
      enabled: ad.enabled !== false,
      imageUrl: ad.imageUrl || "",
      order:   idx + 1
    }));

    const exportLeaders = leaders.map((l, idx) => ({
      name:      l.name      || "",
      role:      l.role      || "",
      link:      l.link      || "",
      sheetUrl:  l.sheetUrl  || "",
      tags:      Array.isArray(l.tags) ? l.tags : [],
      introShort:l.introShort || "",
      sns:       l.sns || { youtube:"", tiktok:"", instagram:"", facebook:"", blog:"", carrot:"", discord:"" },
      enabled:   l.enabled !== false,
      mediaUrl:  l.mediaUrl || l.imageUrl || "",
      order:     idx + 1
    }));

    const jsonObj = {
      tripAds: exportTripAds,
      ads:     exportAds,
      leaders: exportLeaders
    };

    const json = JSON.stringify(jsonObj, null, 2);
    jsonOutput.value = json;
    jsonOutput.scrollTop = 0;
    alert("leaders.json ë‚´ìš©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ì—­ì„ ë³µì‚¬í•˜ê±°ë‚˜ íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
  });

  copyJsonBtn.addEventListener("click", async () => {
    if (!jsonOutput.value.trim()) {
      alert("ë¨¼ì € 'JSON ìƒì„±í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ leaders.json ë‚´ìš©ì„ ìƒì„±í•´ì£¼ì„¸ìš”.");
      return;
    }
    try {
      await navigator.clipboard.writeText(jsonOutput.value);
      alert("JSONì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    } catch {
      jsonOutput.select();
      document.execCommand("copy");
      alert("JSONì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
  });

  downloadJsonBtn.addEventListener("click", () => {
    let text = jsonOutput.value.trim();
    if (!text) {
      generateJsonBtn.click();
      text = jsonOutput.value.trim();
    }
    const blob = new Blob([text], {type: "application/json"});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement("a");
    const now  = new Date();
    const ts   = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,"0")}${String(now.getDate()).padStart(2,"0")}_${String(now.getHours()).padStart(2,"0")}${String(now.getMinutes()).padStart(2,"0")}`;
    a.href = url;
    a.download = `leaders-backup-${ts}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });

  openJsonBtn.addEventListener("click", () => {
    window.open(
      "https://github.com/wordycow/so.t-leader-choice/blob/main/leaders.json",
      "_blank"
    );
  });

  loadJsonBtn.addEventListener("click", () => {
    jsonFileInput.click();
  });

  jsonFileInput.addEventListener("change", () => {
    const file = jsonFileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      const text = e.target.result;
      try {
        const parsed = JSON.parse(text);
        if (!parsed || typeof parsed !== "object") {
          throw new Error("JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
        }

        tripAds = Array.isArray(parsed.tripAds) ? parsed.tripAds : [];
        ads     = Array.isArray(parsed.ads)     ? parsed.ads     : [];
        leaders = Array.isArray(parsed.leaders) ? parsed.leaders : [];

        tripAds.forEach(a => {
          if (typeof a.enabled !== "boolean") a.enabled = a.enabled !== false;
        });
        tripAds.sort((a,b) => (a.order || 9999) - (b.order || 9999));

        ads.forEach(a => {
          if (typeof a.enabled !== "boolean") a.enabled = a.enabled !== false;
        });
        ads.sort((a,b) => (a.order || 9999) - (b.order || 9999));

        leaders.forEach(l => {
          if (!l.sns) l.sns = { youtube:"", tiktok:"", instagram:"", facebook:"", blog:"", carrot:"", discord:"" };
          if (typeof l.enabled !== "boolean") l.enabled = l.enabled !== false;
        });
        leaders.sort((a,b) => (a.order || 9999) - (b.order || 9999));

        data = { tripAds, ads, leaders };
        saveDraft();

        renderTripAds();
        renderAds();
        renderLeaders();
        clearTripForm();
        clearAdForm();
        clearLeaderForm();

        jsonOutput.value = JSON.stringify(parsed, null, 2);

        alert("JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ ê´€ë¦¬ìì— ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.");
      } catch (e) {
        alert("JSON íŒŒì‹± ì˜¤ë¥˜: " + e.message);
      } finally {
        jsonFileInput.value = "";
      }
    };

    reader.readAsText(file, "utf-8");
  });

  // URL â†’ ë¦¬ë” ìë™ ë§¤ì¹­
  if (bulkBtn) {
    bulkBtn.addEventListener("click", () => {
      const raw = (bulkTextarea.value || "").trim();
      if (!raw) {
        bulkStatus.textContent = "URL ëª©ë¡ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.";
        return;
      }

      const lines = raw
        .split(/\r?\n/)
        .map(l => l.trim())
        .filter(Boolean);

      if (!lines.length) {
        bulkStatus.textContent = "ìœ íš¨í•œ URLì´ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      const nameIndexMap = new Map();
      leaders.forEach((leader, idx) => {
        if (leader && leader.name) {
          nameIndexMap.set(leader.name.trim(), idx);
        }
      });

      let matchedByName  = 0;
      let matchedByIndex = 0;
      const unmatched    = [];

      lines.forEach((line, idx) => {
        let name = null;
        try {
          const u = new URL(line);
          u.searchParams.forEach((val, key) => {
            if (!name && key.startsWith("entry.")) {
              name = decodeURIComponent(val);
            }
          });
        } catch (e) {}
        let leaderIndex = -1;
        if (name && nameIndexMap.has(name)) {
          leaderIndex = nameIndexMap.get(name);
          matchedByName++;
        } else if (leaders[idx]) {
          leaderIndex = idx;
          matchedByIndex++;
        } else {
          unmatched.push(line);
        }
        if (leaderIndex >= 0) {
          leaders[leaderIndex].link = line;
        }
      });

      data.leaders = leaders;
      saveDraft();
      renderLeaders();

      let msg = `ì´ë¦„ìœ¼ë¡œ ${matchedByName}ê°œ, ìˆœì„œë¡œ ${matchedByIndex}ê°œ ì ìš©í–ˆìŠµë‹ˆë‹¤.`;
      if (unmatched.length) {
        msg += ` (ë§¤ì¹­ ì‹¤íŒ¨ ${unmatched.length}ê°œëŠ” ë¬´ì‹œë¨)`;
      }
      bulkStatus.textContent = msg;
    });
  }

  // ì´ˆê¸° ë Œë”
  renderTripAds();
  renderAds();
  renderLeaders();
</script>

</body>
</html>
