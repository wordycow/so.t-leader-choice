<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>여행 리더 관리자 페이지 (광고 + JSON 생성기)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #f3f4f6;
      color: #111827;
    }
    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 12px 40px;
    }
    header {
      text-align: center;
      margin-bottom: 18px;
    }
    header h1 {
      margin: 0 0 4px;
      font-size: 22px;
      font-weight: 700;
      color: #111827;
    }
    header p {
      margin: 0;
      font-size: 13px;
      color: #6b7280;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 16px;
    }
    @media (max-width: 960px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px 18px;
      margin-bottom: 12px;
      box-shadow: 0 4px 16px rgba(15,23,42,0.08);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
      color: #111827;
    }
    .card-subtitle {
      font-size: 12px;
      color: #6b7280;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .label-sm {
      font-size: 12px;
      color: #4b5563;
    }
    .input,
    .textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      background: #f9fafb;
    }
    .textarea {
      resize: vertical;
      min-height: 70px;
    }
    .input:focus,
    .textarea:focus {
      outline: none;
      border-color: #111827;
      background: #ffffff;
      box-shadow: 0 0 0 1px #11182722;
    }
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }
    .checkbox-row label {
      font-size: 12px;
      color: #4b5563;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #374151;
      cursor: pointer;
      gap: 4px;
      transition: all 0.16s ease;
      white-space: nowrap;
    }
    .btn:hover {
      background: #f3f4f6;
    }
    .btn-primary {
      border-color: #111827;
      background: #111827;
      color: #f9fafb;
    }
    .btn-primary:hover {
      background: #020617;
    }
    .btn-danger {
      border-color: #b91c1c;
      color: #b91c1c;
    }
    .btn-danger:hover {
      background: #fef2f2;
    }
    .btn-outline {
      border-style: dashed;
      border-color: #d1d5db;
      background: #f9fafb;
    }
    .btn[disabled] {
      opacity: 0.5;
      cursor: default;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid transparent;
    }
    .badge-on {
      background: #ecfdf5;
      border-color: #bbf7d0;
      color: #15803d;
    }
    .badge-off {
      background: #fef2f2;
      border-color: #fecaca;
      color: #b91c1c;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .list-item {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .list-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .list-top-left {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }
    .list-title {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
    }
    .list-sub {
      font-size: 11px;
      color: #6b7280;
    }
    .list-actions {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .list-thumb {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      object-fit: cover;
      border: 1px solid #e5e7eb;
      flex-shrink: 0;
      background: #e5e7eb;
    }

    .json-textarea {
      width: 100%;
      min-height: 150px;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      resize: vertical;
    }
    .json-textarea:focus {
      outline: none;
      border-color: #111827;
      background: #ffffff;
      box-shadow: 0 0 0 1px #11182722;
    }

    .help-text {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    .help-box-yellow {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #fffbeb;
      border: 1px solid #facc15;
      color: #78350f;
      font-size: 11px;
    }
    .help-box-yellow ol {
      padding-left: 18px;
      margin: 4px 0 0;
    }
    .help-box-yellow li {
      margin: 2px 0;
    }

    .status {
      font-size: 11px;
      margin-top: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .status.info {
      color: #2563eb;
      background: #dbeafe;
      border: 1px solid #bfdbfe;
    }
    .status.success {
      color: #15803d;
      background: #dcfce7;
      border: 1px solid #bbf7d0;
    }
    .status.error {
      color: #b91c1c;
      background: #fee2e2;
      border: 1px solid #fecaca;
    }

    /* 이미지 드롭존 & 미리보기 */
    .dropzone {
      margin-top: 4px;
      padding: 10px;
      border-radius: 10px;
      border: 1px dashed #d1d5db;
      font-size: 11px;
      color: #6b7280;
      text-align: center;
      background: #f9fafb;
      cursor: pointer;
    }
    .dropzone.dragover {
      border-color: #111827;
      background: #e5e7eb;
    }
    .image-preview {
      margin-top: 6px;
      max-width: 100%;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>여행 리더 관리자 페이지 (광고 + JSON 생성기)</h1>
      <p>이 페이지에서 광고 배너와 리더 정보를 관리하고, leaders.json을 생성하여 so.t-leader-choice 공개 페이지에 반영합니다.</p>
    </header>

    <div class="layout">
      <!-- 왼쪽 : 입력 폼들 -->
      <div>
        <!-- 광고 배너 관리 -->
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">광고 배너 관리</div>
              <div class="card-subtitle">배너 광고 텍스트와 링크, 노출 여부를 설정합니다.</div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label-sm" for="ad-title">광고 제목</label>
              <input id="ad-title" class="input" type="text" placeholder="예) 광고 1, 어슬렁 여행" />
            </div>
            <div class="form-row">
              <label class="label-sm" for="ad-text">광고 문구 / 설명</label>
              <textarea id="ad-text" class="textarea" placeholder="짧은 한 줄 또는 두 줄 설명"></textarea>
            </div>
            <div class="form-row">
              <label class="label-sm" for="ad-url">광고 링크 URL (예: YouTube, 사이트 등)</label>
              <input id="ad-url" class="input" type="text" placeholder="https://..." />
            </div>

            <!-- 배너 이미지: URL + 파일 선택/드래그 -->
            <div class="form-row">
              <label class="label-sm" for="ad-image-url">배너 이미지 (URL 또는 파일)</label>
              <input id="ad-image-url" class="input" type="text" placeholder="images/banner.jpg 또는 https://.../banner.jpg" />
              <div class="button-row" style="margin-top:4px;">
                <button id="ad-image-file-trigger" class="btn" type="button">이미지 파일 선택 / 드래그</button>
              </div>
              <input id="ad-image-file" type="file" accept="image/*" style="display:none;" />
              <div id="ad-image-drop" class="dropzone">
                이 영역을 클릭하거나, 배너 이미지를 끌어다 놓으면 선택됩니다.
              </div>
              <img id="ad-image-preview" class="image-preview" alt="" style="display:none;" />
              <div class="help-text">
                ※ 선택한 파일 이름 기준으로 <code>images/파일이름</code> 형식으로 URL이 자동 입력됩니다. (이미지는 GitHub 레포의 images 폴더에 따로 업로드해야 실제 페이지에서 보입니다.)
              </div>
            </div>

            <div class="form-row">
              <label class="label-sm" for="ad-position">노출 위치</label>
              <select id="ad-position" class="input">
                <option value="top">상단</option>
                <option value="bottom" selected>하단</option>
              </select>
            </div>
            <div class="checkbox-row">
              <input id="ad-visible" type="checkbox" checked />
              <label for="ad-visible">이 광고 노출</label>
            </div>
          </div>
          <div class="button-row">
            <button id="ad-save-btn" class="btn btn-primary">광고 저장</button>
            <button id="ad-reset-btn" class="btn btn-outline" type="button">광고 폼 초기화</button>
          </div>
        </section>

        <!-- 리더 정보 입력 / 수정 -->
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">리더 정보 입력 / 수정</div>
              <div class="card-subtitle">리더 카드에 표시될 기본 정보를 입력합니다.</div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label-sm" for="leader-name">이름</label>
              <input id="leader-name" class="input" type="text" placeholder="예) 한기림" />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-role">역할 / 직함</label>
              <input id="leader-role" class="input" type="text" placeholder="예) 대장 오로라" />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-headline">한 줄 소개 / 짧은 설명</label>
              <textarea id="leader-headline" class="textarea" placeholder="리더를 한 줄로 소개하는 문장"></textarea>
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-form-url">상담 / 신청 링크 (구글폼 URL)</label>
              <input id="leader-form-url" class="input" type="text" placeholder="https://docs.google.com/forms/..." />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-sheet-url">응답 시트 링크 (구글 시트 URL)</label>
              <input id="leader-sheet-url" class="input" type="text" placeholder="https://docs.google.com/spreadsheets/..." />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-tags">키워드 태그 (쉼표로 구분)</label>
              <input id="leader-tags" class="input" type="text" placeholder="예) 유럽, 자유여행, 소규모, 감성" />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-intro">자세한 설명 / 소개글</label>
              <textarea id="leader-intro" class="textarea" placeholder="카드 하단에 들어갈 조금 더 긴 소개글"></textarea>
            </div>
          </div>
        </section>

        <!-- 리더 SNS + 이미지 -->
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">리더 SNS 채널 / 이미지</div>
              <div class="card-subtitle">SNS 링크와 카드에 사용할 이미지 URL을 입력합니다.</div>
            </div>
          </div>
          <div class="form-grid">
            <div class="form-row">
              <label class="label-sm" for="leader-youtube">YouTube URL</label>
              <input id="leader-youtube" class="input" type="text" placeholder="https://www.youtube.com/..." />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-tiktok">TikTok URL</label>
              <input id="leader-tiktok" class="input" type="text" placeholder="https://www.tiktok.com/..." />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-instagram">Instagram URL</label>
              <input id="leader-instagram" class="input" type="text" placeholder="https://www.instagram.com/..." />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-facebook">Facebook URL</label>
              <input id="leader-facebook" class="input" type="text" placeholder="https://www.facebook.com/..." />
            </div>
            <div class="form-row">
              <label class="label-sm" for="leader-blog">Blog URL</label>
              <input id="leader-blog" class="input" type="text" placeholder="https://blog.naver.com/..." />
            </div>

            <!-- 리더 이미지: URL + 파일 선택/드래그 -->
            <div class="form-row">
              <label class="label-sm" for="leader-image-url">프로필 이미지 (URL 또는 파일)</label>
              <input id="leader-image-url" class="input" type="text" placeholder="images/leader.jpg 또는 https://.../leader.jpg" />
              <div class="button-row" style="margin-top:4px;">
                <button id="leader-image-file-trigger" class="btn" type="button">이미지 파일 선택 / 드래그</button>
              </div>
              <input id="leader-image-file" type="file" accept="image/*" style="display:none;" />
              <div id="leader-image-drop" class="dropzone">
                이 영역을 클릭하거나, 리더 프로필 이미지를 끌어다 놓으면 선택됩니다.
              </div>
              <img id="leader-image-preview" class="image-preview" alt="" style="display:none;" />
              <div class="help-text">
                ※ 선택한 파일 이름 기준으로 <code>images/파일이름</code> 형식으로 URL이 자동 입력됩니다. (이미지는 GitHub 레포의 images 폴더에 따로 업로드해야 실제 페이지에서 보입니다.)
              </div>
            </div>

            <div class="form-row">
              <label class="label-sm" for="leader-order">노출 순서 (숫자, 작을수록 먼저)</label>
              <input id="leader-order" class="input" type="number" min="1" step="1" placeholder="예) 1" />
            </div>
            <div class="checkbox-row">
              <input id="leader-visible" type="checkbox" checked />
              <label for="leader-visible">이 리더 노출</label>
            </div>
          </div>
          <div class="button-row">
            <button id="leader-save-btn" class="btn btn-primary">리더 저장</button>
            <button id="leader-reset-btn" class="btn btn-outline" type="button">리더 폼 초기화</button>
          </div>
        </section>
      </div>

      <!-- 오른쪽 : 리스트 + JSON -->
      <div>
        <!-- 광고 리스트 -->
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">광고 리스트</div>
              <div class="card-subtitle">저장된 광고 배너 목록입니다.</div>
            </div>
          </div>
          <div id="ad-list" class="list"></div>
          <div class="help-text">
            ※ 광고를 수정하려면 오른쪽의 <b>수정</b> 버튼을 누르면 위 광고 폼에 값이 채워집니다.
          </div>
        </section>

        <!-- 리더 리스트 -->
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">리더 리스트</div>
              <div class="card-subtitle">저장된 여행 리더 목록입니다.</div>
            </div>
            <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
              <div class="badge badge-on">현재 리더 수: <span id="leader-count">0</span>명</div>
              <button id="leader-new-btn" class="btn btn-outline" type="button">+ 새 리더 추가</button>
            </div>
          </div>
          <div id="leader-list" class="list"></div>
          <div class="help-text">
            ※ <b>노출 끄기</b> 버튼으로 페이지에 안 보이게 할 수 있고, <b>수정</b>을 누르면 왼쪽 폼에 값이 채워집니다.
          </div>
        </section>

        <!-- JSON 생성 / 복사 / 불러오기 -->
        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">leaders.json 생성 / 복사 / 불러오기</div>
              <div class="card-subtitle">광고 + 리더 정보로 leaders.json을 만들거나, 기존 JSON을 불러와 관리자에 덮어쓸 수 있습니다.</div>
            </div>
          </div>

          <div class="button-row">
            <button id="json-generate-btn" class="btn btn-primary" type="button">JSON 생성하기</button>
            <button id="json-copy-btn" class="btn" type="button">JSON 복사하기</button>
          </div>
          <div class="button-row" style="margin-top:6px;">
            <button id="json-file-btn" class="btn" type="button">JSON 파일 불러오기</button>
            <button id="json-apply-btn" class="btn btn-outline" type="button">JSON → 관리자에 덮어쓰기</button>
          </div>
          <div class="button-row" style="margin-top:6px;">
            <a class="btn btn-outline" href="https://github.com/wordycow/so.t-leader-choice/blob/main/leaders.json" target="_blank" rel="noopener noreferrer">GitHub leaders.json 열기</a>
          </div>

          <textarea id="json-textarea" class="json-textarea" placeholder='{
  "ads": [],
  "leaders": []
}'></textarea>

          <input id="json-file-input" type="file" accept=".json,application/json" style="display:none;" />

          <div id="json-status" class="status info">leaders.json 내용을 이곳에서 생성하거나 불러올 수 있습니다.</div>

          <div class="help-box-yellow">
            <strong>[GitHub에 leaders.json 붙여 넣는 방법]</strong>
            <ol>
              <li><b>JSON 생성하기</b>를 눌러 현재 광고/리더 목록 기준으로 JSON을 만듭니다.</li>
              <li><b>JSON 복사하기</b> 버튼을 눌러 leaders.json 내용을 클립보드에 복사합니다.</li>
              <li><b>GitHub leaders.json 열기</b> 버튼을 눌러 GitHub의 leaders.json 편집 화면으로 이동합니다.</li>
              <li>GitHub에서 내용 전체 선택(Ctrl+A) 후 삭제 → 복사한 JSON을 붙여 넣기(Ctrl+V) 합니다.</li>
              <li>아래쪽 <b>Commit changes</b> 버튼을 눌러 저장합니다.</li>
              <li>공개 페이지(<code>https://wordycow.github.io/so.t-leader-choice/</code>)를 새로고침하면 모든 사용자가 동일한 정보를 보게 됩니다.</li>
            </ol>
          </div>
        </section>
      </div>
    </div>
  </div>

    <script>
    // =============================
    // 전역 상태
    // =============================
    const state = {
      ads: [],
      leaders: [],
      editingAdIndex: null,
      editingLeaderIndex: null
    };

    document.addEventListener("DOMContentLoaded", () => {
      initAdForm();
      initLeaderForm();
      initJsonSection();
      initImagePickers();
      initImageUrlPreview();
      renderAds();
      renderLeaders();
    });

    // =============================
    // 광고 폼
    // =============================
    function initAdForm() {
      const saveBtn = document.getElementById("ad-save-btn");
      const resetBtn = document.getElementById("ad-reset-btn");

      saveBtn.addEventListener("click", () => {
        const ad = getAdFormData();
        if (!ad.title && !ad.text && !ad.url) {
          alert("최소한 광고 제목 또는 문구, 링크 중 하나는 입력해야 저장할 수 있습니다.");
          return;
        }

        if (state.editingAdIndex === null) {
          state.ads.push(ad);
        } else {
          state.ads[state.editingAdIndex] = ad;
        }
        state.editingAdIndex = null;
        clearAdForm();
        renderAds();
      });

      resetBtn.addEventListener("click", () => {
        state.editingAdIndex = null;
        clearAdForm();
      });
    }

    function getAdFormData() {
      const title = document.getElementById("ad-title").value.trim();
      const text = document.getElementById("ad-text").value.trim();
      const url = document.getElementById("ad-url").value.trim();
      const imageUrl = document.getElementById("ad-image-url").value.trim();
      const position = document.getElementById("ad-position").value;
      const visible = document.getElementById("ad-visible").checked;

      const id =
        state.editingAdIndex !== null && state.ads[state.editingAdIndex]
          ? state.ads[state.editingAdIndex].id
          : generateId("ad");

      return {
        id,
        title,
        text,
        url,
        imageUrl,
        position,
        visible
      };
    }

    function setAdFormData(ad) {
      document.getElementById("ad-title").value = ad.title || "";
      document.getElementById("ad-text").value = ad.text || "";
      document.getElementById("ad-url").value = ad.url || "";
      document.getElementById("ad-image-url").value = ad.imageUrl || "";
      document.getElementById("ad-position").value = ad.position || "bottom";
      document.getElementById("ad-visible").checked = ad.visible !== false;
      updateAdPreviewFromUrl();
    }

    function clearAdForm() {
      document.getElementById("ad-title").value = "";
      document.getElementById("ad-text").value = "";
      document.getElementById("ad-url").value = "";
      document.getElementById("ad-image-url").value = "";
      document.getElementById("ad-position").value = "bottom";
      document.getElementById("ad-visible").checked = true;

      const preview = document.getElementById("ad-image-preview");
      preview.style.display = "none";
      preview.src = "";
    }

    function renderAds() {
      const list = document.getElementById("ad-list");
      list.innerHTML = "";

      if (!state.ads.length) {
        const empty = document.createElement("div");
        empty.className = "help-text";
        empty.textContent = "등록된 광고가 없습니다. 왼쪽 폼에서 광고를 추가해 주세요.";
        list.appendChild(empty);
        return;
      }

      state.ads.forEach((ad, index) => {
        const item = document.createElement("div");
        item.className = "list-item";

        const top = document.createElement("div");
        top.className = "list-top";

        const left = document.createElement("div");
        left.className = "list-top-left";

        if (ad.imageUrl) {
          const thumb = document.createElement("img");
          thumb.className = "list-thumb";
          thumb.src = ad.imageUrl;
          thumb.alt = ad.title || "광고 이미지";
          left.appendChild(thumb);
        }

        const title = document.createElement("div");
        title.className = "list-title";
        title.textContent = ad.title || "(제목 없음)";
        left.appendChild(title);

        const badge = document.createElement("span");
        const isVisible = ad.visible !== false;
        badge.className = "badge " + (isVisible ? "badge-on" : "badge-off");
        badge.textContent = isVisible ? "노출 중" : "노출 끔";

        top.appendChild(left);
        top.appendChild(badge);

        const sub = document.createElement("div");
        sub.className = "list-sub";
        sub.textContent = ad.text || "(설명 없음)";

        const url = document.createElement("div");
        url.className = "list-sub";
        url.textContent = ad.url || "";

        const actions = document.createElement("div");
        actions.className = "list-actions";

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "btn";
        toggleBtn.textContent = isVisible ? "노출 끄기" : "노출 켜기";
        toggleBtn.addEventListener("click", () => {
          const current = state.ads[index].visible !== false;
          state.ads[index].visible = !current;
          renderAds();
        });

        const editBtn = document.createElement("button");
        editBtn.className = "btn";
        editBtn.textContent = "수정";
        editBtn.addEventListener("click", () => {
          state.editingAdIndex = index;
          setAdFormData(ad);
          window.scrollTo({ top: 0, behavior: "smooth" });
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-danger";
        deleteBtn.textContent = "삭제";
        deleteBtn.addEventListener("click", () => {
          if (confirm("이 광고를 삭제할까요?")) {
            state.ads.splice(index, 1);
            state.editingAdIndex = null;
            clearAdForm();
            renderAds();
          }
        });

        actions.appendChild(toggleBtn);
        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);

        item.appendChild(top);
        item.appendChild(sub);
        if (ad.url) item.appendChild(url);
        item.appendChild(actions);

        list.appendChild(item);
      });
    }

    // =============================
    // 리더 폼
    // =============================
    function initLeaderForm() {
      const saveBtn = document.getElementById("leader-save-btn");
      const resetBtn = document.getElementById("leader-reset-btn");
      const newBtn = document.getElementById("leader-new-btn");

      saveBtn.addEventListener("click", () => {
        const leader = getLeaderFormData();
        if (!leader.name) {
          alert("리더 이름은 필수입니다.");
          return;
        }

        if (state.editingLeaderIndex === null) {
          state.leaders.push(leader);
        } else {
          state.leaders[state.editingLeaderIndex] = leader;
        }
        state.editingLeaderIndex = null;
        clearLeaderForm();
        renderLeaders();
      });

      resetBtn.addEventListener("click", () => {
        state.editingLeaderIndex = null;
        clearLeaderForm();
      });

      if (newBtn) {
        newBtn.addEventListener("click", () => {
          state.editingLeaderIndex = null;
          clearLeaderForm();
          const nameInput = document.getElementById("leader-name");
          if (nameInput) {
            nameInput.scrollIntoView({ behavior: "smooth", block: "start" });
            nameInput.focus();
          }
        });
      }
    }

    function getLeaderFormData() {
      const name = document.getElementById("leader-name").value.trim();
      const role = document.getElementById("leader-role").value.trim();
      const headline = document.getElementById("leader-headline").value.trim();
      const formUrl = document.getElementById("leader-form-url").value.trim();
      const sheetUrl = document.getElementById("leader-sheet-url").value.trim();
      const tagsStr = document.getElementById("leader-tags").value.trim();
      const intro = document.getElementById("leader-intro").value.trim();

      const youtube = document.getElementById("leader-youtube").value.trim();
      const tiktok = document.getElementById("leader-tiktok").value.trim();
      const instagram = document.getElementById("leader-instagram").value.trim();
      const facebook = document.getElementById("leader-facebook").value.trim();
      const blog = document.getElementById("leader-blog").value.trim();

      const imageUrl = document.getElementById("leader-image-url").value.trim();
      const orderVal = document.getElementById("leader-order").value;
      const visible = document.getElementById("leader-visible").checked;

      const tags = tagsStr
        ? tagsStr.split(",").map(t => t.trim()).filter(Boolean)
        : [];

      const id =
        state.editingLeaderIndex !== null && state.leaders[state.editingLeaderIndex]
          ? state.leaders[state.editingLeaderIndex].id
          : generateId("leader");

      return {
        id,
        name,
        role,
        headline,
        formUrl,
        sheetUrl,
        tags,
        intro,
        sns: { youtube, tiktok, instagram, facebook, blog },
        imageUrl,
        order: orderVal ? Number(orderVal) : null,
        visible
      };
    }

    function setLeaderFormData(leader) {
      document.getElementById("leader-name").value = leader.name || "";
      document.getElementById("leader-role").value = leader.role || "";
      document.getElementById("leader-headline").value = leader.headline || "";
      document.getElementById("leader-form-url").value = leader.formUrl || "";
      document.getElementById("leader-sheet-url").value = leader.sheetUrl || "";
      document.getElementById("leader-tags").value = Array.isArray(leader.tags)
        ? leader.tags.join(", ")
        : "";
      document.getElementById("leader-intro").value = leader.intro || "";

      document.getElementById("leader-youtube").value = leader.sns?.youtube || "";
      document.getElementById("leader-tiktok").value = leader.sns?.tiktok || "";
      document.getElementById("leader-instagram").value = leader.sns?.instagram || "";
      document.getElementById("leader-facebook").value = leader.sns?.facebook || "";
      document.getElementById("leader-blog").value = leader.sns?.blog || "";

      document.getElementById("leader-image-url").value = leader.imageUrl || "";
      document.getElementById("leader-order").value = leader.order ?? "";
      document.getElementById("leader-visible").checked = leader.visible !== false;

      updateLeaderPreviewFromUrl();
    }

    function clearLeaderForm() {
      document.getElementById("leader-name").value = "";
      document.getElementById("leader-role").value = "";
      document.getElementById("leader-headline").value = "";
      document.getElementById("leader-form-url").value = "";
      document.getElementById("leader-sheet-url").value = "";
      document.getElementById("leader-tags").value = "";
      document.getElementById("leader-intro").value = "";

      document.getElementById("leader-youtube").value = "";
      document.getElementById("leader-tiktok").value = "";
      document.getElementById("leader-instagram").value = "";
      document.getElementById("leader-facebook").value = "";
      document.getElementById("leader-blog").value = "";

      document.getElementById("leader-image-url").value = "";
      document.getElementById("leader-order").value = "";
      document.getElementById("leader-visible").checked = true;

      const preview = document.getElementById("leader-image-preview");
      preview.style.display = "none";
      preview.src = "";
    }

    function renderLeaders() {
      const list = document.getElementById("leader-list");
      const countEl = document.getElementById("leader-count");
      list.innerHTML = "";

      const leadersSorted = [...state.leaders].sort((a, b) => {
        const ao = a.order ?? 9999;
        const bo = b.order ?? 9999;
        if (ao === bo) return (a.name || "").localeCompare(b.name || "", "ko");
        return ao - bo;
      });

      countEl.textContent = leadersSorted.length;

      if (!leadersSorted.length) {
        const empty = document.createElement("div");
        empty.className = "help-text";
        empty.textContent = "등록된 리더가 없습니다. 왼쪽 폼에서 리더를 추가해 주세요.";
        list.appendChild(empty);
        return;
      }

      leadersSorted.forEach(leader => {
        const originalIndex = state.leaders.indexOf(leader);

        const item = document.createElement("div");
        item.className = "list-item";

        const top = document.createElement("div");
        top.className = "list-top";

        const left = document.createElement("div");
        left.className = "list-top-left";

        // imageUrl가 없고 mediaUrl만 있는 JSON도 지원
        const thumbSrc = leader.imageUrl || leader.mediaUrl;

        if (thumbSrc) {
        const thumb = document.createElement("img");
        thumb.className = "list-thumb";
        thumb.src = thumbSrc;
        thumb.alt = leader.name || "리더 이미지";
        left.appendChild(thumb);
        }


        const title = document.createElement("div");
        title.className = "list-title";
        title.textContent = leader.name || "(이름 없음)";
        left.appendChild(title);

        const badge = document.createElement("span");
        const isVisible = leader.visible !== false;
        badge.className = "badge " + (isVisible ? "badge-on" : "badge-off");
        badge.textContent = isVisible ? "노출" : "숨김";

        top.appendChild(left);
        top.appendChild(badge);

        const sub = document.createElement("div");
        sub.className = "list-sub";
        const tagsText =
          Array.isArray(leader.tags) && leader.tags.length
            ? "태그: " + leader.tags.join(", ")
            : "태그 없음";
        sub.textContent = (leader.role ? leader.role + " · " : "") + tagsText;

        const linkDiv = document.createElement("div");
        linkDiv.className = "list-sub";
        linkDiv.textContent = leader.formUrl || "";

        const actions = document.createElement("div");
        actions.className = "list-actions";

        const toggleBtn = document.createElement("button");
        toggleBtn.className = "btn";
        toggleBtn.textContent = isVisible ? "노출 끄기" : "노출 켜기";
        toggleBtn.addEventListener("click", () => {
          const target = state.leaders[originalIndex];
          const curr = target.visible !== false;
          target.visible = !curr;
          renderLeaders();
        });

        const editBtn = document.createElement("button");
        editBtn.className = "btn";
        editBtn.textContent = "수정";
        editBtn.addEventListener("click", () => {
          state.editingLeaderIndex = originalIndex;
          setLeaderFormData(leader);
          const nameInput = document.getElementById("leader-name");
          if (nameInput) {
            nameInput.scrollIntoView({ behavior: "smooth", block: "start" });
            nameInput.focus();
          }
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-danger";
        deleteBtn.textContent = "삭제";
        deleteBtn.addEventListener("click", () => {
          if (confirm("이 리더를 삭제할까요?")) {
            state.leaders.splice(originalIndex, 1);
            state.editingLeaderIndex = null;
            clearLeaderForm();
            renderLeaders();
          }
        });

        actions.appendChild(toggleBtn);
        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);

        item.appendChild(top);
        item.appendChild(sub);
        if (leader.formUrl) item.appendChild(linkDiv);
        item.appendChild(actions);

        list.appendChild(item);
      });
    }

    // =============================
    // JSON 섹션
    // =============================
    function initJsonSection() {
      const jsonTextarea = document.getElementById("json-textarea");
      const generateBtn = document.getElementById("json-generate-btn");
      const copyBtn = document.getElementById("json-copy-btn");
      const fileBtn = document.getElementById("json-file-btn");
      const applyBtn = document.getElementById("json-apply-btn");
      const fileInput = document.getElementById("json-file-input");

      generateBtn.addEventListener("click", () => {
        const obj = {
          ads: state.ads,
          leaders: state.leaders
        };
        jsonTextarea.value = JSON.stringify(obj, null, 2);
        setJsonStatus("현재 관리자 데이터를 기반으로 JSON을 생성했습니다.", "success");
      });

      copyBtn.addEventListener("click", () => {
        const text = jsonTextarea.value;
        if (!text.trim()) {
          setJsonStatus("복사할 JSON 내용이 없습니다.", "error");
          return;
        }
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(text)
            .then(() => setJsonStatus("JSON을 클립보드에 복사했습니다.", "success"))
            .catch(() => {
              fallbackCopy(text);
              setJsonStatus("브라우저 제한으로 기본 복사 방식을 사용했습니다.", "info");
            });
        } else {
          fallbackCopy(text);
          setJsonStatus("브라우저 제한으로 기본 복사 방식을 사용했습니다.", "info");
        }
      });

      // JSON 파일 불러오기
      fileBtn.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", () => {
        const file = fileInput.files && fileInput.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          jsonTextarea.value = reader.result;
          setJsonStatus(
            "JSON 파일을 불러왔습니다. 내용을 확인한 후 “JSON → 관리자에 덮어쓰기”를 눌러 적용하세요.",
            "info"
          );
          fileInput.value = "";
        };
        reader.onerror = () => {
          setJsonStatus("JSON 파일을 읽는 중 오류가 발생했습니다.", "error");
          fileInput.value = "";
        };
        reader.readAsText(file, "utf-8");
      });

      // JSON → 관리자에 덮어쓰기
      applyBtn.addEventListener("click", () => {
        const text = jsonTextarea.value.trim();
        if (!text) {
          setJsonStatus("덮어쓸 JSON 내용이 비어 있습니다.", "error");
          return;
        }
        try {
          const parsed = JSON.parse(text);
          const root = parsed.data ? parsed.data : parsed;

          const adsRaw = Array.isArray(root.ads) ? root.ads : [];
          const leadersRaw = Array.isArray(root.leaders) ? root.leaders : [];

          // 여기서 옛날 / 새 JSON 모두를 정리해서 state로 만듦
          state.ads = adsRaw.map((ad, idx) => normalizeAd(ad, idx));
          state.leaders = leadersRaw.map((leader, idx) => normalizeLeader(leader, idx));

          state.editingAdIndex = null;
          state.editingLeaderIndex = null;

          clearAdForm();
          clearLeaderForm();
          renderAds();
          renderLeaders();

          setJsonStatus("JSON 내용을 관리자 데이터에 성공적으로 덮어썼습니다.", "success");
        } catch (err) {
          setJsonStatus("JSON 파싱 오류: " + err.message, "error");
        }
      });
    }

    function setJsonStatus(message, type) {
      const el = document.getElementById("json-status");
      el.textContent = message;
      el.className = "status " + (type || "info");
    }

    function fallbackCopy(text) {
      const temp = document.createElement("textarea");
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
    }

    // =============================
    // 이미지 파일 선택 / 드래그 공통 함수
    // =============================
    function initImagePickers() {
      initImageFilePicker({
        fileInputId: "ad-image-file",
        triggerId: "ad-image-file-trigger",
        dropId: "ad-image-drop",
        previewId: "ad-image-preview",
        targetInputId: "ad-image-url",
        folderPrefix: "images/"
      });

      initImageFilePicker({
        fileInputId: "leader-image-file",
        triggerId: "leader-image-file-trigger",
        dropId: "leader-image-drop",
        previewId: "leader-image-preview",
        targetInputId: "leader-image-url",
        folderPrefix: "images/"
      });
    }

    function initImageFilePicker({
      fileInputId,
      triggerId,
      dropId,
      previewId,
      targetInputId,
      folderPrefix
    }) {
      const fileInput = document.getElementById(fileInputId);
      const trigger = document.getElementById(triggerId);
      const drop = document.getElementById(dropId);
      const preview = document.getElementById(previewId);
      const targetInput = document.getElementById(targetInputId);
      if (!fileInput || !trigger || !drop || !targetInput) return;

      const handleFiles = files => {
        if (!files || !files.length) return;
        const file = files[0];
        const fileName = file.name;
        const url = (folderPrefix || "") + fileName;
        targetInput.value = url;
        if (preview) {
          const objectUrl = URL.createObjectURL(file);
          preview.src = objectUrl;
          preview.style.display = "block";
        }
      };

      trigger.addEventListener("click", () => fileInput.click());
      drop.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", e => handleFiles(e.target.files));

      drop.addEventListener("dragover", e => {
        e.preventDefault();
        drop.classList.add("dragover");
      });
      drop.addEventListener("dragleave", e => {
        e.preventDefault();
        drop.classList.remove("dragover");
      });
      drop.addEventListener("drop", e => {
        e.preventDefault();
        drop.classList.remove("dragover");
        const dt = e.dataTransfer;
        if (dt && dt.files) handleFiles(dt.files);
      });
    }

    // =============================
    // URL 입력 → 미리보기 갱신
    // =============================
    function initImageUrlPreview() {
      const adUrlInput = document.getElementById("ad-image-url");
      const leaderUrlInput = document.getElementById("leader-image-url");
      if (adUrlInput) {
        adUrlInput.addEventListener("input", updateAdPreviewFromUrl);
      }
      if (leaderUrlInput) {
        leaderUrlInput.addEventListener("input", updateLeaderPreviewFromUrl);
      }
    }

    function updateAdPreviewFromUrl() {
      const url = document.getElementById("ad-image-url").value.trim();
      const preview = document.getElementById("ad-image-preview");
      if (!preview) return;
      if (url) {
        preview.src = url;
        preview.style.display = "block";
      } else {
        preview.src = "";
        preview.style.display = "none";
      }
    }

    function updateLeaderPreviewFromUrl() {
      const url = document.getElementById("leader-image-url").value.trim();
      const preview = document.getElementById("leader-image-preview");
      if (!preview) return;
      if (url) {
        preview.src = url;
        preview.style.display = "block";
      } else {
        preview.src = "";
        preview.style.display = "none";
      }
    }

    // =============================
    // JSON 정규화 (옛날 / 새 필드 이름 맞춰주기)
    // =============================
    function normalizeAd(ad, index) {
      const out = { ...ad };

      if (!out.id) out.id = ad.id || generateId("ad");
      if (out.visible === undefined) out.visible = ad.visible !== false;

      if (!out.imageUrl) {
        out.imageUrl =
          ad.imageUrl ||
          ad.bannerImage ||
          ad.banner_image ||
          ad.bannerUrl ||
          ad.banner_url ||
          ad.image ||
          "";
      }

      return out;
    }

    function normalizeLeader(leader, index) {
  const out = { ...leader };

  // id 없으면 새로 부여
  if (!out.id) out.id = leader.id || generateId("leader");

  // visible 값 정리
  if (out.visible === undefined) out.visible = leader.visible !== false;
  // 옛날 JSON에서 enabled 라는 이름을 썼다면 그것도 반영
  if (leader.enabled !== undefined && out.visible === undefined) {
    out.visible = !!leader.enabled;
  }

  // 이미지 필드: 오래된 JSON은 mediaUrl 을 쓰고 있을 수 있음
  out.imageUrl =
    leader.imageUrl ||       // 새 관리자에서 쓰는 필드
    leader.mediaUrl  ||       // 예전 관리자에서 쓰던 필드
    leader.profileImage ||
    leader.profile_image ||
    leader.profileImageUrl ||
    leader.profile_image_url ||
    leader.image ||
    "";

  // tags 가 문자열이면 쉼표로 쪼개서 배열로
  if (!Array.isArray(out.tags) && typeof leader.tags === "string") {
    out.tags = leader.tags
      .split(",")
      .map(t => t.trim())
      .filter(Boolean);
  }

  // sns 없으면 기본값
  if (!out.sns) {
    out.sns = leader.sns || { youtube: "", tiktok: "", instagram: "", facebook: "", blog: "" };
  }

  // order 가 없으면 "들어온 순서"로 부여 → JSON 순서 그대로 유지
  if (typeof out.order !== "number") {
    out.order = index + 1;
  }

  return out;
}


    // =============================
    // 유틸
    // =============================
    function generateId(prefix) {
      const now = Date.now().toString(36);
      const rand = Math.random().toString(36).substring(2, 7);
      return prefix + "-" + now + "-" + rand;
    }
  </script>
</body>
</html>
