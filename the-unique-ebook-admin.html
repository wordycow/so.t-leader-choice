<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>The Unique – eBook 관리자</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 24px 16px 40px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    h1 {
      margin: 0 0 12px;
      font-size: 22px;
    }
    .tip {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 16px;
    }
    .book-list {
      max-width: 1100px;
      margin: 0 auto 24px;
    }
    .book-row {
      display: flex;
      gap: 16px;
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 14px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.5);
    }
    .thumb {
      flex: 0 0 140px;
    }
    .thumb-frame {
      width: 140px;
      height: 140px;
      border-radius: 16px;
      overflow: hidden;
      background: #111827;
      border: 1px solid #4b5563;
    }
    .thumb-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .fields {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px 16px;
      align-content: flex-start;
    }
    .field {
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }
    .field label {
      margin-bottom: 4px;
      color: #9ca3af;
    }
    .field input[type="text"],
    .field input[type="number"],
    .field select {
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
    }
    .field input[type="checkbox"] {
      transform: scale(1.1);
    }
    .field input[type="range"] {
      width: 100%;
    }
    .field span.value {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }
    .row-actions {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-end;
      gap: 8px;
      flex: 0 0 80px;
    }
    .btn-small {
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid rgba(239,68,68,0.7);
      background: transparent;
      color: #fecaca;
      font-size: 11px;
      cursor: pointer;
    }
    .btn-small:hover {
      background: rgba(239,68,68,0.2);
    }

    .export-box {
      max-width: 1100px;
      margin: 0 auto;
    }
    .export-btn, .add-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      background: #f97316;
      color: #111827;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 8px;
      margin-right: 8px;
    }
    .add-btn {
      background: #22c55e;
      color: #022c22;
    }
    textarea {
      width: 100%;
      min-height: 260px;
      border-radius: 12px;
      padding: 10px;
      font-size: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      resize: vertical;
    }
    .export-help {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    @media (max-width: 700px) {
      .book-row {
        flex-direction: column;
      }
      .row-actions {
        flex-direction: row;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <h1>The Unique eBook 관리자</h1>
  <div class="tip">
    ▸ 각 책의 <b>제목 / 부제 / 커버 / mp4 / mp3 / 노출 / 직급 범위 / 순서 / 이미지 위치</b>를 조정한 뒤,<br>
    ▸ <b>JSON 내보내기</b> 버튼을 눌러 나온 내용을 <code>ebook-config.json</code>에 복사해서 저장하면 됩니다.
  </div>

  <div id="bookList" class="book-list"></div>

  <div class="export-box">
    <button id="addBtn" class="add-btn">+ 책 추가</button>
    <button id="exportBtn" class="export-btn">JSON 내보내기</button>
    <div class="export-help">
      • 내보낸 JSON 전체를 복사(Ctrl+A → Ctrl+C) 후, GitHub의 <code>ebook-config.json</code>에 붙여넣고 저장하세요.
    </div>
    <textarea id="jsonOutput" readonly placeholder="여기에 JSON이 생성됩니다."></textarea>
  </div>

  <script>
    const RANKS = [
      "", "Star1", "Star2", "Star3",
      "Pro1", "Pro2", "Pro3", "Pro4",
      "Pro5", "Pro6", "Pro7", "Pro8", "Pro9", "Pro10"
    ];

    // 기본 샘플 (ebook-config.json이 아직 없을 때 사용)
    let items = [
      {
        id: "unique-basic",
        title: "협력을 배우고 협력을 만들어낸다.",
        subtitle: "THE UNIQUE 기본 매뉴얼",
        description: "누구나 언제라도 다시 볼 수 있는 THE UNIQUE 기본 매뉴얼입니다.",
        cover: "img/ebook-the-unique-system-book.jpg",
        video: "img/the-unique-system.mp4",
        audio: "audio/the-unique-system.mp3",
        link: "ebook.html",
        visible: true,
        rankMin: "Star1",
        rankMax: "Pro10",
        order: 1,
        posY: 50
      },
      {
        id: "unique-sot",
        title: "현대 사회에 맞는 여행도구 so.t",
        subtitle: "so.t 안에서 서로를 챙겨주며 함께 여행을 그린다.",
        description: "",
        cover: "img/ebook-network-marketing-cover.jpg",
        video: "img/the-unique-sot.mp4",
        audio: "audio/the-unique-sot.mp3",
        link: "ebook1.html",
        visible: true,
        rankMin: "Pro1",
        rankMax: "Pro10",
        order: 2,
        posY: 50
      }
    ];

    // ebook-config.json 이 있으면 그걸로 덮어쓰기
    fetch("ebook-config.json")
      .then(function(res) {
        if (!res.ok) throw new Error("status " + res.status);
        return res.json();
      })
      .then(function(data) {
        if (data && Array.isArray(data.items) && data.items.length > 0) {
          items = data.items;
        }
        normalizeItems();
        renderList();
      })
      .catch(function(err) {
        console.warn("ebook-config.json 불러오기 실패, 기본값 사용:", err);
        normalizeItems();
        renderList();
      });

    function normalizeItems() {
      items.forEach(function(item, index) {
        if (typeof item.order !== "number") item.order = index + 1;
        if (typeof item.posY !== "number") item.posY = 50;
        if (typeof item.visible !== "boolean") item.visible = true;
      });
    }

    function renderList() {
      const listEl = document.getElementById("bookList");
      listEl.innerHTML = "";

      items.forEach(function(item, index) {
        const row = document.createElement("div");
        row.className = "book-row";

        // 썸네일
        const thumb = document.createElement("div");
        thumb.className = "thumb";
        const frame = document.createElement("div");
        frame.className = "thumb-frame";
        const img = document.createElement("img");
        img.src = item.cover || "";
        img.alt = item.title || "";
        const posY = (typeof item.posY === "number") ? item.posY : 50;
        img.style.objectPosition = "50% " + posY + "%";
        frame.appendChild(img);
        thumb.appendChild(frame);

        // 필드들
        const fields = document.createElement("div");
        fields.className = "fields";

        // ID
        fields.appendChild(makeTextField("ID (영문 키)", item.id || "", function(v) {
          item.id = v.trim();
        }));

        // 제목
        fields.appendChild(makeTextField("제목", item.title || "", function(v) {
          item.title = v;
        }));

        // 부제
        fields.appendChild(makeTextField("부제", item.subtitle || "", function(v) {
          item.subtitle = v;
        }));

        // 커버 이미지 경로
        const coverField = makeTextField("커버 이미지 경로", item.cover || "", function(v) {
          item.cover = v;
          img.src = v;
        });
        fields.appendChild(coverField);

        // 영상(mp4) 경로
        fields.appendChild(makeTextField("영상 파일(mp4) 경로", item.video || "", function(v) {
          item.video = v;
        }));

        // 음성(mp3) 경로
        fields.appendChild(makeTextField("음성 파일(mp3) 경로", item.audio || "", function(v) {
          item.audio = v;
        }));

        // 링크
        fields.appendChild(makeTextField("클릭 시 이동할 링크", item.link || "", function(v) {
          item.link = v;
        }));

        // 노출 여부
        const visibleField = document.createElement("div");
        visibleField.className = "field";
        const vLabel = document.createElement("label");
        vLabel.textContent = "노출";
        const vInput = document.createElement("input");
        vInput.type = "checkbox";
        vInput.checked = item.visible !== false;
        vInput.addEventListener("change", function() {
          item.visible = this.checked;
        });
        visibleField.appendChild(vLabel);
        visibleField.appendChild(vInput);
        fields.appendChild(visibleField);

        // 최소 직급
        fields.appendChild(makeRankField("최소 직급(rankMin)", item.rankMin, function(v) {
          item.rankMin = v || null;
        }));

        // 최대 직급
        fields.appendChild(makeRankField("최대 직급(rankMax)", item.rankMax, function(v) {
          item.rankMax = v || null;
        }));

        // 순서(order)
        const orderField = document.createElement("div");
        orderField.className = "field";
        const oLabel = document.createElement("label");
        oLabel.textContent = "순서(order)";
        const oInput = document.createElement("input");
        oInput.type = "number";
        oInput.value = item.order || (index + 1);
        oInput.addEventListener("input", function() {
          item.order = parseInt(this.value || "0", 10);
        });
        orderField.appendChild(oLabel);
        orderField.appendChild(oInput);
        fields.appendChild(orderField);

        // 이미지 세로 위치(posY)
        const posField = document.createElement("div");
        posField.className = "field";
        const pLabel = document.createElement("label");
        pLabel.textContent = "이미지 세로 위치(posY)";
        const pRange = document.createElement("input");
        pRange.type = "range";
        pRange.min = "0";
        pRange.max = "100";
        pRange.value = posY;
        const pVal = document.createElement("span");
        pVal.className = "value";
        pVal.textContent = posY + "%";
        pRange.addEventListener("input", function() {
          const v = parseInt(this.value, 10);
          item.posY = v;
          pVal.textContent = v + "%";
          img.style.objectPosition = "50% " + v + "%";
        });
        posField.appendChild(pLabel);
        posField.appendChild(pRange);
        posField.appendChild(pVal);
        fields.appendChild(posField);

        // 오른쪽 삭제 버튼
        const rowActions = document.createElement("div");
        rowActions.className = "row-actions";
        const delBtn = document.createElement("button");
        delBtn.className = "btn-small";
        delBtn.textContent = "삭제";
        delBtn.addEventListener("click", function() {
          if (confirm("이 eBook을 삭제할까요?")) {
            items.splice(index, 1);
            renderList();
          }
        });
        rowActions.appendChild(delBtn);

        row.appendChild(thumb);
        row.appendChild(fields);
        row.appendChild(rowActions);

        listEl.appendChild(row);
      });
    }

    function makeTextField(labelText, value, onChange) {
      const field = document.createElement("div");
      field.className = "field";
      const label = document.createElement("label");
      label.textContent = labelText;
      const input = document.createElement("input");
      input.type = "text";
      input.value = value;
      input.addEventListener("input", function() {
        onChange(this.value);
      });
      field.appendChild(label);
      field.appendChild(input);
      return field;
    }

    function makeRankField(labelText, value, onChange) {
      const field = document.createElement("div");
      field.className = "field";
      const label = document.createElement("label");
      label.textContent = labelText;
      const select = document.createElement("select");
      RANKS.forEach(function(r) {
        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r === "" ? "제한 없음" : r;
        if (r === (value || "")) opt.selected = true;
        select.appendChild(opt);
      });
      select.addEventListener("change", function() {
        onChange(this.value);
      });
      field.appendChild(label);
      field.appendChild(select);
      return field;
    }

    // 책 추가 버튼
    document.getElementById("addBtn").addEventListener("click", function() {
      const n = items.length + 1;
      items.push({
        id: "ebook-" + n,
        title: "새 eBook " + n,
        subtitle: "",
        description: "",
        cover: "",
        video: "",
        audio: "",
        link: "",
        visible: true,
        rankMin: "",
        rankMax: "",
        order: n,
        posY: 50
      });
      renderList();
    });

    // JSON 내보내기
    document.getElementById("exportBtn").addEventListener("click", function() {
      const output = { items: items };
      document.getElementById("jsonOutput").value =
        JSON.stringify(output, null, 2);
    });
  </script>
</body>
</html>
